!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.lux=n():t.lux=n()}(window,function(){return function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n,e){"use strict";e.r(n);var r={};e.d(r,"EPSILON",function(){return m}),e.d(r,"ARRAY_TYPE",function(){return p}),e.d(r,"RANDOM",function(){return M}),e.d(r,"setMatrixArrayType",function(){return b}),e.d(r,"toRadian",function(){return v}),e.d(r,"equals",function(){return _});var i={};e.d(i,"create",function(){return w}),e.d(i,"clone",function(){return E}),e.d(i,"copy",function(){return x}),e.d(i,"identity",function(){return A}),e.d(i,"fromValues",function(){return T}),e.d(i,"set",function(){return R}),e.d(i,"transpose",function(){return F}),e.d(i,"invert",function(){return S}),e.d(i,"adjoint",function(){return y}),e.d(i,"determinant",function(){return C}),e.d(i,"multiply",function(){return D}),e.d(i,"rotate",function(){return O}),e.d(i,"scale",function(){return P}),e.d(i,"fromRotation",function(){return N}),e.d(i,"fromScaling",function(){return L}),e.d(i,"str",function(){return B}),e.d(i,"frob",function(){return U}),e.d(i,"LDU",function(){return q}),e.d(i,"add",function(){return I}),e.d(i,"subtract",function(){return G}),e.d(i,"exactEquals",function(){return j}),e.d(i,"equals",function(){return k}),e.d(i,"multiplyScalar",function(){return V}),e.d(i,"multiplyScalarAndAdd",function(){return H}),e.d(i,"mul",function(){return z}),e.d(i,"sub",function(){return X});var o={};e.d(o,"create",function(){return W}),e.d(o,"clone",function(){return Y}),e.d(o,"copy",function(){return Q}),e.d(o,"identity",function(){return $}),e.d(o,"fromValues",function(){return K}),e.d(o,"set",function(){return Z}),e.d(o,"invert",function(){return J}),e.d(o,"determinant",function(){return tt}),e.d(o,"multiply",function(){return nt}),e.d(o,"rotate",function(){return et}),e.d(o,"scale",function(){return rt}),e.d(o,"translate",function(){return it}),e.d(o,"fromRotation",function(){return ot}),e.d(o,"fromScaling",function(){return at}),e.d(o,"fromTranslation",function(){return ut}),e.d(o,"str",function(){return st}),e.d(o,"frob",function(){return ct}),e.d(o,"add",function(){return ht}),e.d(o,"subtract",function(){return ft}),e.d(o,"multiplyScalar",function(){return lt}),e.d(o,"multiplyScalarAndAdd",function(){return dt}),e.d(o,"exactEquals",function(){return mt}),e.d(o,"equals",function(){return pt}),e.d(o,"mul",function(){return Mt}),e.d(o,"sub",function(){return bt});var a={};e.d(a,"create",function(){return gt}),e.d(a,"fromMat4",function(){return vt}),e.d(a,"clone",function(){return _t}),e.d(a,"copy",function(){return wt}),e.d(a,"fromValues",function(){return Et}),e.d(a,"set",function(){return xt}),e.d(a,"identity",function(){return At}),e.d(a,"transpose",function(){return Tt}),e.d(a,"invert",function(){return Rt}),e.d(a,"adjoint",function(){return Ft}),e.d(a,"determinant",function(){return St}),e.d(a,"multiply",function(){return yt}),e.d(a,"translate",function(){return Ct}),e.d(a,"rotate",function(){return Dt}),e.d(a,"scale",function(){return Ot}),e.d(a,"fromTranslation",function(){return Pt}),e.d(a,"fromRotation",function(){return Nt}),e.d(a,"fromScaling",function(){return Lt}),e.d(a,"fromMat2d",function(){return Bt}),e.d(a,"fromQuat",function(){return Ut}),e.d(a,"normalFromMat4",function(){return qt}),e.d(a,"projection",function(){return It}),e.d(a,"str",function(){return Gt}),e.d(a,"frob",function(){return jt}),e.d(a,"add",function(){return kt}),e.d(a,"subtract",function(){return Vt}),e.d(a,"multiplyScalar",function(){return Ht}),e.d(a,"multiplyScalarAndAdd",function(){return zt}),e.d(a,"exactEquals",function(){return Xt}),e.d(a,"equals",function(){return Wt}),e.d(a,"mul",function(){return Yt}),e.d(a,"sub",function(){return Qt});var u={};e.d(u,"create",function(){return $t}),e.d(u,"clone",function(){return Kt}),e.d(u,"copy",function(){return Zt}),e.d(u,"fromValues",function(){return Jt}),e.d(u,"set",function(){return tn}),e.d(u,"identity",function(){return nn}),e.d(u,"transpose",function(){return en}),e.d(u,"invert",function(){return rn}),e.d(u,"adjoint",function(){return on}),e.d(u,"determinant",function(){return an}),e.d(u,"multiply",function(){return un}),e.d(u,"translate",function(){return sn}),e.d(u,"scale",function(){return cn}),e.d(u,"rotate",function(){return hn}),e.d(u,"rotateX",function(){return fn}),e.d(u,"rotateY",function(){return ln}),e.d(u,"rotateZ",function(){return dn}),e.d(u,"fromTranslation",function(){return mn}),e.d(u,"fromScaling",function(){return pn}),e.d(u,"fromRotation",function(){return Mn}),e.d(u,"fromXRotation",function(){return bn}),e.d(u,"fromYRotation",function(){return gn}),e.d(u,"fromZRotation",function(){return vn}),e.d(u,"fromRotationTranslation",function(){return _n}),e.d(u,"getTranslation",function(){return wn}),e.d(u,"getScaling",function(){return En}),e.d(u,"getRotation",function(){return xn}),e.d(u,"fromRotationTranslationScale",function(){return An}),e.d(u,"fromRotationTranslationScaleOrigin",function(){return Tn}),e.d(u,"fromQuat",function(){return Rn}),e.d(u,"frustum",function(){return Fn}),e.d(u,"perspective",function(){return Sn}),e.d(u,"perspectiveFromFieldOfView",function(){return yn}),e.d(u,"ortho",function(){return Cn}),e.d(u,"lookAt",function(){return Dn}),e.d(u,"targetTo",function(){return On}),e.d(u,"str",function(){return Pn}),e.d(u,"frob",function(){return Nn}),e.d(u,"add",function(){return Ln}),e.d(u,"subtract",function(){return Bn}),e.d(u,"multiplyScalar",function(){return Un}),e.d(u,"multiplyScalarAndAdd",function(){return qn}),e.d(u,"exactEquals",function(){return In}),e.d(u,"equals",function(){return Gn}),e.d(u,"mul",function(){return jn}),e.d(u,"sub",function(){return kn});var s={};e.d(s,"create",function(){return Vn}),e.d(s,"clone",function(){return Hn}),e.d(s,"length",function(){return zn}),e.d(s,"fromValues",function(){return Xn}),e.d(s,"copy",function(){return Wn}),e.d(s,"set",function(){return Yn}),e.d(s,"add",function(){return Qn}),e.d(s,"subtract",function(){return $n}),e.d(s,"multiply",function(){return Kn}),e.d(s,"divide",function(){return Zn}),e.d(s,"ceil",function(){return Jn}),e.d(s,"floor",function(){return te}),e.d(s,"min",function(){return ne}),e.d(s,"max",function(){return ee}),e.d(s,"round",function(){return re}),e.d(s,"scale",function(){return ie}),e.d(s,"scaleAndAdd",function(){return oe}),e.d(s,"distance",function(){return ae}),e.d(s,"squaredDistance",function(){return ue}),e.d(s,"squaredLength",function(){return se}),e.d(s,"negate",function(){return ce}),e.d(s,"inverse",function(){return he}),e.d(s,"normalize",function(){return fe}),e.d(s,"dot",function(){return le}),e.d(s,"cross",function(){return de}),e.d(s,"lerp",function(){return me}),e.d(s,"hermite",function(){return pe}),e.d(s,"bezier",function(){return Me}),e.d(s,"random",function(){return be}),e.d(s,"transformMat4",function(){return ge}),e.d(s,"transformMat3",function(){return ve}),e.d(s,"transformQuat",function(){return _e}),e.d(s,"rotateX",function(){return we}),e.d(s,"rotateY",function(){return Ee}),e.d(s,"rotateZ",function(){return xe}),e.d(s,"angle",function(){return Ae}),e.d(s,"str",function(){return Te}),e.d(s,"exactEquals",function(){return Re}),e.d(s,"equals",function(){return Fe}),e.d(s,"sub",function(){return Se}),e.d(s,"mul",function(){return ye}),e.d(s,"div",function(){return Ce}),e.d(s,"dist",function(){return De}),e.d(s,"sqrDist",function(){return Oe}),e.d(s,"len",function(){return Pe}),e.d(s,"sqrLen",function(){return Ne}),e.d(s,"forEach",function(){return Le});var c={};e.d(c,"create",function(){return Be}),e.d(c,"clone",function(){return Ue}),e.d(c,"fromValues",function(){return qe}),e.d(c,"copy",function(){return Ie}),e.d(c,"set",function(){return Ge}),e.d(c,"add",function(){return je}),e.d(c,"subtract",function(){return ke}),e.d(c,"multiply",function(){return Ve}),e.d(c,"divide",function(){return He}),e.d(c,"ceil",function(){return ze}),e.d(c,"floor",function(){return Xe}),e.d(c,"min",function(){return We}),e.d(c,"max",function(){return Ye}),e.d(c,"round",function(){return Qe}),e.d(c,"scale",function(){return $e}),e.d(c,"scaleAndAdd",function(){return Ke}),e.d(c,"distance",function(){return Ze}),e.d(c,"squaredDistance",function(){return Je}),e.d(c,"length",function(){return tr}),e.d(c,"squaredLength",function(){return nr}),e.d(c,"negate",function(){return er}),e.d(c,"inverse",function(){return rr}),e.d(c,"normalize",function(){return ir}),e.d(c,"dot",function(){return or}),e.d(c,"lerp",function(){return ar}),e.d(c,"random",function(){return ur}),e.d(c,"transformMat4",function(){return sr}),e.d(c,"transformQuat",function(){return cr}),e.d(c,"str",function(){return hr}),e.d(c,"exactEquals",function(){return fr}),e.d(c,"equals",function(){return lr}),e.d(c,"sub",function(){return dr}),e.d(c,"mul",function(){return mr}),e.d(c,"div",function(){return pr}),e.d(c,"dist",function(){return Mr}),e.d(c,"sqrDist",function(){return br}),e.d(c,"len",function(){return gr}),e.d(c,"sqrLen",function(){return vr}),e.d(c,"forEach",function(){return _r});var h={};e.d(h,"create",function(){return wr}),e.d(h,"identity",function(){return Er}),e.d(h,"setAxisAngle",function(){return xr}),e.d(h,"getAxisAngle",function(){return Ar}),e.d(h,"multiply",function(){return Tr}),e.d(h,"rotateX",function(){return Rr}),e.d(h,"rotateY",function(){return Fr}),e.d(h,"rotateZ",function(){return Sr}),e.d(h,"calculateW",function(){return yr}),e.d(h,"slerp",function(){return Cr}),e.d(h,"invert",function(){return Dr}),e.d(h,"conjugate",function(){return Or}),e.d(h,"fromMat3",function(){return Pr}),e.d(h,"fromEuler",function(){return Nr}),e.d(h,"str",function(){return Lr}),e.d(h,"clone",function(){return Br}),e.d(h,"fromValues",function(){return Ur}),e.d(h,"copy",function(){return qr}),e.d(h,"set",function(){return Ir}),e.d(h,"add",function(){return Gr}),e.d(h,"mul",function(){return jr}),e.d(h,"scale",function(){return kr}),e.d(h,"dot",function(){return Vr}),e.d(h,"lerp",function(){return Hr}),e.d(h,"length",function(){return zr}),e.d(h,"len",function(){return Xr}),e.d(h,"squaredLength",function(){return Wr}),e.d(h,"sqrLen",function(){return Yr}),e.d(h,"normalize",function(){return Qr}),e.d(h,"exactEquals",function(){return $r}),e.d(h,"equals",function(){return Kr}),e.d(h,"rotationTo",function(){return Zr}),e.d(h,"sqlerp",function(){return Jr}),e.d(h,"setAxes",function(){return ti});var f={};e.d(f,"create",function(){return ni}),e.d(f,"clone",function(){return ei}),e.d(f,"fromValues",function(){return ri}),e.d(f,"copy",function(){return ii}),e.d(f,"set",function(){return oi}),e.d(f,"add",function(){return ai}),e.d(f,"subtract",function(){return ui}),e.d(f,"multiply",function(){return si}),e.d(f,"divide",function(){return ci}),e.d(f,"ceil",function(){return hi}),e.d(f,"floor",function(){return fi}),e.d(f,"min",function(){return li}),e.d(f,"max",function(){return di}),e.d(f,"round",function(){return mi}),e.d(f,"scale",function(){return pi}),e.d(f,"scaleAndAdd",function(){return Mi}),e.d(f,"distance",function(){return bi}),e.d(f,"squaredDistance",function(){return gi}),e.d(f,"length",function(){return vi}),e.d(f,"squaredLength",function(){return _i}),e.d(f,"negate",function(){return wi}),e.d(f,"inverse",function(){return Ei}),e.d(f,"normalize",function(){return xi}),e.d(f,"dot",function(){return Ai}),e.d(f,"cross",function(){return Ti}),e.d(f,"lerp",function(){return Ri}),e.d(f,"random",function(){return Fi}),e.d(f,"transformMat2",function(){return Si}),e.d(f,"transformMat2d",function(){return yi}),e.d(f,"transformMat3",function(){return Ci}),e.d(f,"transformMat4",function(){return Di}),e.d(f,"str",function(){return Oi}),e.d(f,"exactEquals",function(){return Pi}),e.d(f,"equals",function(){return Ni}),e.d(f,"len",function(){return Li}),e.d(f,"sub",function(){return Bi}),e.d(f,"mul",function(){return Ui}),e.d(f,"div",function(){return qi}),e.d(f,"dist",function(){return Ii}),e.d(f,"sqrDist",function(){return Gi}),e.d(f,"sqrLen",function(){return ji}),e.d(f,"forEach",function(){return ki});let l=new class{constructor(t){let n=this;this.domElement=t||document.createElement("CANVAS"),this.context=this.domElement.getContext("webgl2"),this.viewport={width:window.innerWidth,height:window.innerHeight,aspect:()=>{n.viewport.width,n.viewport.height}},this.context||(this.context=this.domElement.getContext("experimental-webgl2")),this.context||console.error("Your browser does not support webgl 2."),this.isFullscreen=!0,this.context.viewport(0,0,this.viewport.width,this.viewport.height),this.onResizeCallback=(()=>{}),this.onResize=function(){let t=0,e=0;n.isFullscreen?(t=window.innerWidth,e=window.innerHeight):(t=n.domElement.clientWidth,e=n.domElement.clientHeight),n.domElement.width==t&&n.domElement.height==e||(n.domElement.width=t,n.domElement.height=e,n.viewport.width=t,n.viewport.height=e,n.context.viewport(0,0,n.viewport.width,n.viewport.height)),n.onResizeCallback()},window.addEventListener("resize",this.onResize),this.setup()}setup(){this.ext={color_buffer_float:this.context.getExtension("EXT_color_buffer_float")}}fullscreen(t){this.isFullscreen=t,this.onResize()}setClearColor(t,n,e,r){this.context.clearColor(t,n,e,r)}},d=l.context;const m=1e-6;let p="undefined"!=typeof Float32Array?Float32Array:Array;const M=Math.random;function b(t){p=t}const g=Math.PI/180;function v(t){return t*g}function _(t,n){return Math.abs(t-n)<=m*Math.max(1,Math.abs(t),Math.abs(n))}function w(){let t=new p(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function E(t){let n=new p(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function x(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function A(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function T(t,n,e,r){let i=new p(4);return i[0]=t,i[1]=n,i[2]=e,i[3]=r,i}function R(t,n,e,r,i){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t}function F(t,n){if(t===n){let e=n[1];t[1]=n[2],t[2]=e}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t}function S(t,n){let e=n[0],r=n[1],i=n[2],o=n[3],a=e*o-i*r;return a?(a=1/a,t[0]=o*a,t[1]=-r*a,t[2]=-i*a,t[3]=e*a,t):null}function y(t,n){let e=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=e,t}function C(t){return t[0]*t[3]-t[2]*t[1]}function D(t,n,e){let r=n[0],i=n[1],o=n[2],a=n[3],u=e[0],s=e[1],c=e[2],h=e[3];return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*c+o*h,t[3]=i*c+a*h,t}function O(t,n,e){let r=n[0],i=n[1],o=n[2],a=n[3],u=Math.sin(e),s=Math.cos(e);return t[0]=r*s+o*u,t[1]=i*s+a*u,t[2]=r*-u+o*s,t[3]=i*-u+a*s,t}function P(t,n,e){let r=n[0],i=n[1],o=n[2],a=n[3],u=e[0],s=e[1];return t[0]=r*u,t[1]=i*u,t[2]=o*s,t[3]=a*s,t}function N(t,n){let e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=e,t[2]=-e,t[3]=r,t}function L(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t}function B(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function U(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))}function q(t,n,e,r){return t[2]=r[2]/r[0],e[0]=r[0],e[1]=r[1],e[3]=r[3]-t[2]*e[1],[t,n,e]}function I(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t}function G(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t}function j(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function k(t,n){let e=t[0],r=t[1],i=t[2],o=t[3],a=n[0],u=n[1],s=n[2],c=n[3];return Math.abs(e-a)<=m*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(r-u)<=m*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-s)<=m*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-c)<=m*Math.max(1,Math.abs(o),Math.abs(c))}function V(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t}function H(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t}const z=D,X=G;function W(){let t=new p(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Y(t){let n=new p(6);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n}function Q(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t}function $(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function K(t,n,e,r,i,o){let a=new p(6);return a[0]=t,a[1]=n,a[2]=e,a[3]=r,a[4]=i,a[5]=o,a}function Z(t,n,e,r,i,o,a){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t}function J(t,n){let e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],u=n[5],s=e*o-r*i;return s?(s=1/s,t[0]=o*s,t[1]=-r*s,t[2]=-i*s,t[3]=e*s,t[4]=(i*u-o*a)*s,t[5]=(r*a-e*u)*s,t):null}function tt(t){return t[0]*t[3]-t[1]*t[2]}function nt(t,n,e){let r=n[0],i=n[1],o=n[2],a=n[3],u=n[4],s=n[5],c=e[0],h=e[1],f=e[2],l=e[3],d=e[4],m=e[5];return t[0]=r*c+o*h,t[1]=i*c+a*h,t[2]=r*f+o*l,t[3]=i*f+a*l,t[4]=r*d+o*m+u,t[5]=i*d+a*m+s,t}function et(t,n,e){let r=n[0],i=n[1],o=n[2],a=n[3],u=n[4],s=n[5],c=Math.sin(e),h=Math.cos(e);return t[0]=r*h+o*c,t[1]=i*h+a*c,t[2]=r*-c+o*h,t[3]=i*-c+a*h,t[4]=u,t[5]=s,t}function rt(t,n,e){let r=n[0],i=n[1],o=n[2],a=n[3],u=n[4],s=n[5],c=e[0],h=e[1];return t[0]=r*c,t[1]=i*c,t[2]=o*h,t[3]=a*h,t[4]=u,t[5]=s,t}function it(t,n,e){let r=n[0],i=n[1],o=n[2],a=n[3],u=n[4],s=n[5],c=e[0],h=e[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=r*c+o*h+u,t[5]=i*c+a*h+s,t}function ot(t,n){let e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=e,t[2]=-e,t[3]=r,t[4]=0,t[5]=0,t}function at(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t[4]=0,t[5]=0,t}function ut(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=n[0],t[5]=n[1],t}function st(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function ct(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)}function ht(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t[4]=n[4]+e[4],t[5]=n[5]+e[5],t}function ft(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t[4]=n[4]-e[4],t[5]=n[5]-e[5],t}function lt(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*e,t[5]=n[5]*e,t}function dt(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t[4]=n[4]+e[4]*r,t[5]=n[5]+e[5]*r,t}function mt(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]}function pt(t,n){let e=t[0],r=t[1],i=t[2],o=t[3],a=t[4],u=t[5],s=n[0],c=n[1],h=n[2],f=n[3],l=n[4],d=n[5];return Math.abs(e-s)<=m*Math.max(1,Math.abs(e),Math.abs(s))&&Math.abs(r-c)<=m*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-h)<=m*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-f)<=m*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-l)<=m*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(u-d)<=m*Math.max(1,Math.abs(u),Math.abs(d))}const Mt=nt,bt=ft;function gt(){let t=new p(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function vt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t}function _t(t){let n=new p(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n}function wt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t}function Et(t,n,e,r,i,o,a,u,s){let c=new p(9);return c[0]=t,c[1]=n,c[2]=e,c[3]=r,c[4]=i,c[5]=o,c[6]=a,c[7]=u,c[8]=s,c}function xt(t,n,e,r,i,o,a,u,s,c){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=u,t[7]=s,t[8]=c,t}function At(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Tt(t,n){if(t===n){let e=n[1],r=n[2],i=n[5];t[1]=n[3],t[2]=n[6],t[3]=e,t[5]=n[7],t[6]=r,t[7]=i}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t}function Rt(t,n){let e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],u=n[5],s=n[6],c=n[7],h=n[8],f=h*a-u*c,l=-h*o+u*s,d=c*o-a*s,m=e*f+r*l+i*d;return m?(m=1/m,t[0]=f*m,t[1]=(-h*r+i*c)*m,t[2]=(u*r-i*a)*m,t[3]=l*m,t[4]=(h*e-i*s)*m,t[5]=(-u*e+i*o)*m,t[6]=d*m,t[7]=(-c*e+r*s)*m,t[8]=(a*e-r*o)*m,t):null}function Ft(t,n){let e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],u=n[5],s=n[6],c=n[7],h=n[8];return t[0]=a*h-u*c,t[1]=i*c-r*h,t[2]=r*u-i*a,t[3]=u*s-o*h,t[4]=e*h-i*s,t[5]=i*o-e*u,t[6]=o*c-a*s,t[7]=r*s-e*c,t[8]=e*a-r*o,t}function St(t){let n=t[0],e=t[1],r=t[2],i=t[3],o=t[4],a=t[5],u=t[6],s=t[7],c=t[8];return n*(c*o-a*s)+e*(-c*i+a*u)+r*(s*i-o*u)}function yt(t,n,e){let r=n[0],i=n[1],o=n[2],a=n[3],u=n[4],s=n[5],c=n[6],h=n[7],f=n[8],l=e[0],d=e[1],m=e[2],p=e[3],M=e[4],b=e[5],g=e[6],v=e[7],_=e[8];return t[0]=l*r+d*a+m*c,t[1]=l*i+d*u+m*h,t[2]=l*o+d*s+m*f,t[3]=p*r+M*a+b*c,t[4]=p*i+M*u+b*h,t[5]=p*o+M*s+b*f,t[6]=g*r+v*a+_*c,t[7]=g*i+v*u+_*h,t[8]=g*o+v*s+_*f,t}function Ct(t,n,e){let r=n[0],i=n[1],o=n[2],a=n[3],u=n[4],s=n[5],c=n[6],h=n[7],f=n[8],l=e[0],d=e[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=u,t[5]=s,t[6]=l*r+d*a+c,t[7]=l*i+d*u+h,t[8]=l*o+d*s+f,t}function Dt(t,n,e){let r=n[0],i=n[1],o=n[2],a=n[3],u=n[4],s=n[5],c=n[6],h=n[7],f=n[8],l=Math.sin(e),d=Math.cos(e);return t[0]=d*r+l*a,t[1]=d*i+l*u,t[2]=d*o+l*s,t[3]=d*a-l*r,t[4]=d*u-l*i,t[5]=d*s-l*o,t[6]=c,t[7]=h,t[8]=f,t}function Ot(t,n,e){let r=e[0],i=e[1];return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=i*n[3],t[4]=i*n[4],t[5]=i*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t}function Pt(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=n[0],t[7]=n[1],t[8]=1,t}function Nt(t,n){let e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=e,t[2]=0,t[3]=-e,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Lt(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=n[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Bt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t}function Ut(t,n){let e=n[0],r=n[1],i=n[2],o=n[3],a=e+e,u=r+r,s=i+i,c=e*a,h=r*a,f=r*u,l=i*a,d=i*u,m=i*s,p=o*a,M=o*u,b=o*s;return t[0]=1-f-m,t[3]=h-b,t[6]=l+M,t[1]=h+b,t[4]=1-c-m,t[7]=d-p,t[2]=l-M,t[5]=d+p,t[8]=1-c-f,t}function qt(t,n){let e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],u=n[5],s=n[6],c=n[7],h=n[8],f=n[9],l=n[10],d=n[11],m=n[12],p=n[13],M=n[14],b=n[15],g=e*u-r*a,v=e*s-i*a,_=e*c-o*a,w=r*s-i*u,E=r*c-o*u,x=i*c-o*s,A=h*p-f*m,T=h*M-l*m,R=h*b-d*m,F=f*M-l*p,S=f*b-d*p,y=l*b-d*M,C=g*y-v*S+_*F+w*R-E*T+x*A;return C?(C=1/C,t[0]=(u*y-s*S+c*F)*C,t[1]=(s*R-a*y-c*T)*C,t[2]=(a*S-u*R+c*A)*C,t[3]=(i*S-r*y-o*F)*C,t[4]=(e*y-i*R+o*T)*C,t[5]=(r*R-e*S-o*A)*C,t[6]=(p*x-M*E+b*w)*C,t[7]=(M*_-m*x-b*v)*C,t[8]=(m*E-p*_+b*g)*C,t):null}function It(t,n,e){return t[0]=2/n,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/e,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Gt(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function jt(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))}function kt(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t[4]=n[4]+e[4],t[5]=n[5]+e[5],t[6]=n[6]+e[6],t[7]=n[7]+e[7],t[8]=n[8]+e[8],t}function Vt(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t[4]=n[4]-e[4],t[5]=n[5]-e[5],t[6]=n[6]-e[6],t[7]=n[7]-e[7],t[8]=n[8]-e[8],t}function Ht(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*e,t[5]=n[5]*e,t[6]=n[6]*e,t[7]=n[7]*e,t[8]=n[8]*e,t}function zt(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t[4]=n[4]+e[4]*r,t[5]=n[5]+e[5]*r,t[6]=n[6]+e[6]*r,t[7]=n[7]+e[7]*r,t[8]=n[8]+e[8]*r,t}function Xt(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]}function Wt(t,n){let e=t[0],r=t[1],i=t[2],o=t[3],a=t[4],u=t[5],s=t[6],c=t[7],h=t[8],f=n[0],l=n[1],d=n[2],p=n[3],M=n[4],b=n[5],g=n[6],v=n[7],_=n[8];return Math.abs(e-f)<=m*Math.max(1,Math.abs(e),Math.abs(f))&&Math.abs(r-l)<=m*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-d)<=m*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-p)<=m*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-M)<=m*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(u-b)<=m*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(s-g)<=m*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(c-v)<=m*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(h-_)<=m*Math.max(1,Math.abs(h),Math.abs(_))}const Yt=yt,Qt=Vt;function $t(){let t=new p(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Kt(t){let n=new p(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function Zt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function Jt(t,n,e,r,i,o,a,u,s,c,h,f,l,d,m,M){let b=new p(16);return b[0]=t,b[1]=n,b[2]=e,b[3]=r,b[4]=i,b[5]=o,b[6]=a,b[7]=u,b[8]=s,b[9]=c,b[10]=h,b[11]=f,b[12]=l,b[13]=d,b[14]=m,b[15]=M,b}function tn(t,n,e,r,i,o,a,u,s,c,h,f,l,d,m,p,M){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=u,t[7]=s,t[8]=c,t[9]=h,t[10]=f,t[11]=l,t[12]=d,t[13]=m,t[14]=p,t[15]=M,t}function nn(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function en(t,n){if(t===n){let e=n[1],r=n[2],i=n[3],o=n[6],a=n[7],u=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=e,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=o,t[11]=n[14],t[12]=i,t[13]=a,t[14]=u}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t}function rn(t,n){let e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],u=n[5],s=n[6],c=n[7],h=n[8],f=n[9],l=n[10],d=n[11],m=n[12],p=n[13],M=n[14],b=n[15],g=e*u-r*a,v=e*s-i*a,_=e*c-o*a,w=r*s-i*u,E=r*c-o*u,x=i*c-o*s,A=h*p-f*m,T=h*M-l*m,R=h*b-d*m,F=f*M-l*p,S=f*b-d*p,y=l*b-d*M,C=g*y-v*S+_*F+w*R-E*T+x*A;return C?(C=1/C,t[0]=(u*y-s*S+c*F)*C,t[1]=(i*S-r*y-o*F)*C,t[2]=(p*x-M*E+b*w)*C,t[3]=(l*E-f*x-d*w)*C,t[4]=(s*R-a*y-c*T)*C,t[5]=(e*y-i*R+o*T)*C,t[6]=(M*_-m*x-b*v)*C,t[7]=(h*x-l*_+d*v)*C,t[8]=(a*S-u*R+c*A)*C,t[9]=(r*R-e*S-o*A)*C,t[10]=(m*E-p*_+b*g)*C,t[11]=(f*_-h*E-d*g)*C,t[12]=(u*T-a*F-s*A)*C,t[13]=(e*F-r*T+i*A)*C,t[14]=(p*v-m*w-M*g)*C,t[15]=(h*w-f*v+l*g)*C,t):null}function on(t,n){let e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],u=n[5],s=n[6],c=n[7],h=n[8],f=n[9],l=n[10],d=n[11],m=n[12],p=n[13],M=n[14],b=n[15];return t[0]=u*(l*b-d*M)-f*(s*b-c*M)+p*(s*d-c*l),t[1]=-(r*(l*b-d*M)-f*(i*b-o*M)+p*(i*d-o*l)),t[2]=r*(s*b-c*M)-u*(i*b-o*M)+p*(i*c-o*s),t[3]=-(r*(s*d-c*l)-u*(i*d-o*l)+f*(i*c-o*s)),t[4]=-(a*(l*b-d*M)-h*(s*b-c*M)+m*(s*d-c*l)),t[5]=e*(l*b-d*M)-h*(i*b-o*M)+m*(i*d-o*l),t[6]=-(e*(s*b-c*M)-a*(i*b-o*M)+m*(i*c-o*s)),t[7]=e*(s*d-c*l)-a*(i*d-o*l)+h*(i*c-o*s),t[8]=a*(f*b-d*p)-h*(u*b-c*p)+m*(u*d-c*f),t[9]=-(e*(f*b-d*p)-h*(r*b-o*p)+m*(r*d-o*f)),t[10]=e*(u*b-c*p)-a*(r*b-o*p)+m*(r*c-o*u),t[11]=-(e*(u*d-c*f)-a*(r*d-o*f)+h*(r*c-o*u)),t[12]=-(a*(f*M-l*p)-h*(u*M-s*p)+m*(u*l-s*f)),t[13]=e*(f*M-l*p)-h*(r*M-i*p)+m*(r*l-i*f),t[14]=-(e*(u*M-s*p)-a*(r*M-i*p)+m*(r*s-i*u)),t[15]=e*(u*l-s*f)-a*(r*l-i*f)+h*(r*s-i*u),t}function an(t){let n=t[0],e=t[1],r=t[2],i=t[3],o=t[4],a=t[5],u=t[6],s=t[7],c=t[8],h=t[9],f=t[10],l=t[11],d=t[12],m=t[13],p=t[14],M=t[15];return(n*a-e*o)*(f*M-l*p)-(n*u-r*o)*(h*M-l*m)+(n*s-i*o)*(h*p-f*m)+(e*u-r*a)*(c*M-l*d)-(e*s-i*a)*(c*p-f*d)+(r*s-i*u)*(c*m-h*d)}function un(t,n,e){let r=n[0],i=n[1],o=n[2],a=n[3],u=n[4],s=n[5],c=n[6],h=n[7],f=n[8],l=n[9],d=n[10],m=n[11],p=n[12],M=n[13],b=n[14],g=n[15],v=e[0],_=e[1],w=e[2],E=e[3];return t[0]=v*r+_*u+w*f+E*p,t[1]=v*i+_*s+w*l+E*M,t[2]=v*o+_*c+w*d+E*b,t[3]=v*a+_*h+w*m+E*g,v=e[4],_=e[5],w=e[6],E=e[7],t[4]=v*r+_*u+w*f+E*p,t[5]=v*i+_*s+w*l+E*M,t[6]=v*o+_*c+w*d+E*b,t[7]=v*a+_*h+w*m+E*g,v=e[8],_=e[9],w=e[10],E=e[11],t[8]=v*r+_*u+w*f+E*p,t[9]=v*i+_*s+w*l+E*M,t[10]=v*o+_*c+w*d+E*b,t[11]=v*a+_*h+w*m+E*g,v=e[12],_=e[13],w=e[14],E=e[15],t[12]=v*r+_*u+w*f+E*p,t[13]=v*i+_*s+w*l+E*M,t[14]=v*o+_*c+w*d+E*b,t[15]=v*a+_*h+w*m+E*g,t}function sn(t,n,e){let r,i,o,a,u,s,c,h,f,l,d,m,p=e[0],M=e[1],b=e[2];return n===t?(t[12]=n[0]*p+n[4]*M+n[8]*b+n[12],t[13]=n[1]*p+n[5]*M+n[9]*b+n[13],t[14]=n[2]*p+n[6]*M+n[10]*b+n[14],t[15]=n[3]*p+n[7]*M+n[11]*b+n[15]):(r=n[0],i=n[1],o=n[2],a=n[3],u=n[4],s=n[5],c=n[6],h=n[7],f=n[8],l=n[9],d=n[10],m=n[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=u,t[5]=s,t[6]=c,t[7]=h,t[8]=f,t[9]=l,t[10]=d,t[11]=m,t[12]=r*p+u*M+f*b+n[12],t[13]=i*p+s*M+l*b+n[13],t[14]=o*p+c*M+d*b+n[14],t[15]=a*p+h*M+m*b+n[15]),t}function cn(t,n,e){let r=e[0],i=e[1],o=e[2];return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=n[7]*i,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=n[11]*o,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function hn(t,n,e,r){let i,o,a,u,s,c,h,f,l,d,p,M,b,g,v,_,w,E,x,A,T,R,F,S,y=r[0],C=r[1],D=r[2],O=Math.sqrt(y*y+C*C+D*D);return Math.abs(O)<m?null:(y*=O=1/O,C*=O,D*=O,i=Math.sin(e),a=1-(o=Math.cos(e)),u=n[0],s=n[1],c=n[2],h=n[3],f=n[4],l=n[5],d=n[6],p=n[7],M=n[8],b=n[9],g=n[10],v=n[11],_=y*y*a+o,w=C*y*a+D*i,E=D*y*a-C*i,x=y*C*a-D*i,A=C*C*a+o,T=D*C*a+y*i,R=y*D*a+C*i,F=C*D*a-y*i,S=D*D*a+o,t[0]=u*_+f*w+M*E,t[1]=s*_+l*w+b*E,t[2]=c*_+d*w+g*E,t[3]=h*_+p*w+v*E,t[4]=u*x+f*A+M*T,t[5]=s*x+l*A+b*T,t[6]=c*x+d*A+g*T,t[7]=h*x+p*A+v*T,t[8]=u*R+f*F+M*S,t[9]=s*R+l*F+b*S,t[10]=c*R+d*F+g*S,t[11]=h*R+p*F+v*S,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)}function fn(t,n,e){let r=Math.sin(e),i=Math.cos(e),o=n[4],a=n[5],u=n[6],s=n[7],c=n[8],h=n[9],f=n[10],l=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=o*i+c*r,t[5]=a*i+h*r,t[6]=u*i+f*r,t[7]=s*i+l*r,t[8]=c*i-o*r,t[9]=h*i-a*r,t[10]=f*i-u*r,t[11]=l*i-s*r,t}function ln(t,n,e){let r=Math.sin(e),i=Math.cos(e),o=n[0],a=n[1],u=n[2],s=n[3],c=n[8],h=n[9],f=n[10],l=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*i-c*r,t[1]=a*i-h*r,t[2]=u*i-f*r,t[3]=s*i-l*r,t[8]=o*r+c*i,t[9]=a*r+h*i,t[10]=u*r+f*i,t[11]=s*r+l*i,t}function dn(t,n,e){let r=Math.sin(e),i=Math.cos(e),o=n[0],a=n[1],u=n[2],s=n[3],c=n[4],h=n[5],f=n[6],l=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*i+c*r,t[1]=a*i+h*r,t[2]=u*i+f*r,t[3]=s*i+l*r,t[4]=c*i-o*r,t[5]=h*i-a*r,t[6]=f*i-u*r,t[7]=l*i-s*r,t}function mn(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function pn(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Mn(t,n,e){let r,i,o,a=e[0],u=e[1],s=e[2],c=Math.sqrt(a*a+u*u+s*s);return Math.abs(c)<m?null:(a*=c=1/c,u*=c,s*=c,r=Math.sin(n),o=1-(i=Math.cos(n)),t[0]=a*a*o+i,t[1]=u*a*o+s*r,t[2]=s*a*o-u*r,t[3]=0,t[4]=a*u*o-s*r,t[5]=u*u*o+i,t[6]=s*u*o+a*r,t[7]=0,t[8]=a*s*o+u*r,t[9]=u*s*o-a*r,t[10]=s*s*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function bn(t,n){let e=Math.sin(n),r=Math.cos(n);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=e,t[7]=0,t[8]=0,t[9]=-e,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function gn(t,n){let e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=0,t[2]=-e,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=e,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vn(t,n){let e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=e,t[2]=0,t[3]=0,t[4]=-e,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _n(t,n,e){let r=n[0],i=n[1],o=n[2],a=n[3],u=r+r,s=i+i,c=o+o,h=r*u,f=r*s,l=r*c,d=i*s,m=i*c,p=o*c,M=a*u,b=a*s,g=a*c;return t[0]=1-(d+p),t[1]=f+g,t[2]=l-b,t[3]=0,t[4]=f-g,t[5]=1-(h+p),t[6]=m+M,t[7]=0,t[8]=l+b,t[9]=m-M,t[10]=1-(h+d),t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function wn(t,n){return t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function En(t,n){let e=n[0],r=n[1],i=n[2],o=n[4],a=n[5],u=n[6],s=n[8],c=n[9],h=n[10];return t[0]=Math.sqrt(e*e+r*r+i*i),t[1]=Math.sqrt(o*o+a*a+u*u),t[2]=Math.sqrt(s*s+c*c+h*h),t}function xn(t,n){let e=n[0]+n[5]+n[10],r=0;return e>0?(r=2*Math.sqrt(e+1),t[3]=.25*r,t[0]=(n[6]-n[9])/r,t[1]=(n[8]-n[2])/r,t[2]=(n[1]-n[4])/r):n[0]>n[5]&n[0]>n[10]?(r=2*Math.sqrt(1+n[0]-n[5]-n[10]),t[3]=(n[6]-n[9])/r,t[0]=.25*r,t[1]=(n[1]+n[4])/r,t[2]=(n[8]+n[2])/r):n[5]>n[10]?(r=2*Math.sqrt(1+n[5]-n[0]-n[10]),t[3]=(n[8]-n[2])/r,t[0]=(n[1]+n[4])/r,t[1]=.25*r,t[2]=(n[6]+n[9])/r):(r=2*Math.sqrt(1+n[10]-n[0]-n[5]),t[3]=(n[1]-n[4])/r,t[0]=(n[8]+n[2])/r,t[1]=(n[6]+n[9])/r,t[2]=.25*r),t}function An(t,n,e,r){let i=n[0],o=n[1],a=n[2],u=n[3],s=i+i,c=o+o,h=a+a,f=i*s,l=i*c,d=i*h,m=o*c,p=o*h,M=a*h,b=u*s,g=u*c,v=u*h,_=r[0],w=r[1],E=r[2];return t[0]=(1-(m+M))*_,t[1]=(l+v)*_,t[2]=(d-g)*_,t[3]=0,t[4]=(l-v)*w,t[5]=(1-(f+M))*w,t[6]=(p+b)*w,t[7]=0,t[8]=(d+g)*E,t[9]=(p-b)*E,t[10]=(1-(f+m))*E,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Tn(t,n,e,r,i){let o=n[0],a=n[1],u=n[2],s=n[3],c=o+o,h=a+a,f=u+u,l=o*c,d=o*h,m=o*f,p=a*h,M=a*f,b=u*f,g=s*c,v=s*h,_=s*f,w=r[0],E=r[1],x=r[2],A=i[0],T=i[1],R=i[2];return t[0]=(1-(p+b))*w,t[1]=(d+_)*w,t[2]=(m-v)*w,t[3]=0,t[4]=(d-_)*E,t[5]=(1-(l+b))*E,t[6]=(M+g)*E,t[7]=0,t[8]=(m+v)*x,t[9]=(M-g)*x,t[10]=(1-(l+p))*x,t[11]=0,t[12]=e[0]+A-(t[0]*A+t[4]*T+t[8]*R),t[13]=e[1]+T-(t[1]*A+t[5]*T+t[9]*R),t[14]=e[2]+R-(t[2]*A+t[6]*T+t[10]*R),t[15]=1,t}function Rn(t,n){let e=n[0],r=n[1],i=n[2],o=n[3],a=e+e,u=r+r,s=i+i,c=e*a,h=r*a,f=r*u,l=i*a,d=i*u,m=i*s,p=o*a,M=o*u,b=o*s;return t[0]=1-f-m,t[1]=h+b,t[2]=l-M,t[3]=0,t[4]=h-b,t[5]=1-c-m,t[6]=d+p,t[7]=0,t[8]=l+M,t[9]=d-p,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Fn(t,n,e,r,i,o,a){let u=1/(e-n),s=1/(i-r),c=1/(o-a);return t[0]=2*o*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*s,t[6]=0,t[7]=0,t[8]=(e+n)*u,t[9]=(i+r)*s,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0,t}function Sn(t,n,e,r,i){let o=1/Math.tan(n/2),a=1/(r-i);return t[0]=o/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+r)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*r*a,t[15]=0,t}function yn(t,n,e,r){let i=Math.tan(n.upDegrees*Math.PI/180),o=Math.tan(n.downDegrees*Math.PI/180),a=Math.tan(n.leftDegrees*Math.PI/180),u=Math.tan(n.rightDegrees*Math.PI/180),s=2/(a+u),c=2/(i+o);return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-u)*s*.5,t[9]=(i-o)*c*.5,t[10]=r/(e-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*e/(e-r),t[15]=0,t}function Cn(t,n,e,r,i,o,a){let u=1/(n-e),s=1/(r-i),c=1/(o-a);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(n+e)*u,t[13]=(i+r)*s,t[14]=(a+o)*c,t[15]=1,t}function Dn(t,n,e,r){let i,o,a,u,s,c,h,f,l,d,p=n[0],M=n[1],b=n[2],g=r[0],v=r[1],_=r[2],w=e[0],E=e[1],x=e[2];return Math.abs(p-w)<m&&Math.abs(M-E)<m&&Math.abs(b-x)<m?mat4.identity(t):(h=p-w,f=M-E,l=b-x,i=v*(l*=d=1/Math.sqrt(h*h+f*f+l*l))-_*(f*=d),o=_*(h*=d)-g*l,a=g*f-v*h,(d=Math.sqrt(i*i+o*o+a*a))?(i*=d=1/d,o*=d,a*=d):(i=0,o=0,a=0),u=f*a-l*o,s=l*i-h*a,c=h*o-f*i,(d=Math.sqrt(u*u+s*s+c*c))?(u*=d=1/d,s*=d,c*=d):(u=0,s=0,c=0),t[0]=i,t[1]=u,t[2]=h,t[3]=0,t[4]=o,t[5]=s,t[6]=f,t[7]=0,t[8]=a,t[9]=c,t[10]=l,t[11]=0,t[12]=-(i*p+o*M+a*b),t[13]=-(u*p+s*M+c*b),t[14]=-(h*p+f*M+l*b),t[15]=1,t)}function On(t,n,e,r){let i=n[0],o=n[1],a=n[2],u=r[0],s=r[1],c=r[2],h=i-e[0],f=o-e[1],l=a-e[2],d=h*h+f*f+l*l;d>0&&(h*=d=1/Math.sqrt(d),f*=d,l*=d);let m=s*l-c*f,p=c*h-u*l,M=u*f-s*h;return t[0]=m,t[1]=p,t[2]=M,t[3]=0,t[4]=f*M-l*p,t[5]=l*m-h*M,t[6]=h*p-f*m,t[7]=0,t[8]=h,t[9]=f,t[10]=l,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function Pn(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Nn(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))}function Ln(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t[4]=n[4]+e[4],t[5]=n[5]+e[5],t[6]=n[6]+e[6],t[7]=n[7]+e[7],t[8]=n[8]+e[8],t[9]=n[9]+e[9],t[10]=n[10]+e[10],t[11]=n[11]+e[11],t[12]=n[12]+e[12],t[13]=n[13]+e[13],t[14]=n[14]+e[14],t[15]=n[15]+e[15],t}function Bn(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t[4]=n[4]-e[4],t[5]=n[5]-e[5],t[6]=n[6]-e[6],t[7]=n[7]-e[7],t[8]=n[8]-e[8],t[9]=n[9]-e[9],t[10]=n[10]-e[10],t[11]=n[11]-e[11],t[12]=n[12]-e[12],t[13]=n[13]-e[13],t[14]=n[14]-e[14],t[15]=n[15]-e[15],t}function Un(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*e,t[5]=n[5]*e,t[6]=n[6]*e,t[7]=n[7]*e,t[8]=n[8]*e,t[9]=n[9]*e,t[10]=n[10]*e,t[11]=n[11]*e,t[12]=n[12]*e,t[13]=n[13]*e,t[14]=n[14]*e,t[15]=n[15]*e,t}function qn(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t[4]=n[4]+e[4]*r,t[5]=n[5]+e[5]*r,t[6]=n[6]+e[6]*r,t[7]=n[7]+e[7]*r,t[8]=n[8]+e[8]*r,t[9]=n[9]+e[9]*r,t[10]=n[10]+e[10]*r,t[11]=n[11]+e[11]*r,t[12]=n[12]+e[12]*r,t[13]=n[13]+e[13]*r,t[14]=n[14]+e[14]*r,t[15]=n[15]+e[15]*r,t}function In(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]}function Gn(t,n){let e=t[0],r=t[1],i=t[2],o=t[3],a=t[4],u=t[5],s=t[6],c=t[7],h=t[8],f=t[9],l=t[10],d=t[11],p=t[12],M=t[13],b=t[14],g=t[15],v=n[0],_=n[1],w=n[2],E=n[3],x=n[4],A=n[5],T=n[6],R=n[7],F=n[8],S=n[9],y=n[10],C=n[11],D=n[12],O=n[13],P=n[14],N=n[15];return Math.abs(e-v)<=m*Math.max(1,Math.abs(e),Math.abs(v))&&Math.abs(r-_)<=m*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-w)<=m*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(o-E)<=m*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(a-x)<=m*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(u-A)<=m*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(s-T)<=m*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(c-R)<=m*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(h-F)<=m*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(f-S)<=m*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(l-y)<=m*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(d-C)<=m*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(p-D)<=m*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(M-O)<=m*Math.max(1,Math.abs(M),Math.abs(O))&&Math.abs(b-P)<=m*Math.max(1,Math.abs(b),Math.abs(P))&&Math.abs(g-N)<=m*Math.max(1,Math.abs(g),Math.abs(N))}const jn=un,kn=Bn;function Vn(){let t=new p(3);return t[0]=0,t[1]=0,t[2]=0,t}function Hn(t){var n=new p(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function zn(t){let n=t[0],e=t[1],r=t[2];return Math.sqrt(n*n+e*e+r*r)}function Xn(t,n,e){let r=new p(3);return r[0]=t,r[1]=n,r[2]=e,r}function Wn(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function Yn(t,n,e,r){return t[0]=n,t[1]=e,t[2]=r,t}function Qn(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t}function $n(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t}function Kn(t,n,e){return t[0]=n[0]*e[0],t[1]=n[1]*e[1],t[2]=n[2]*e[2],t}function Zn(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t[2]=n[2]/e[2],t}function Jn(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t}function te(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t}function ne(t,n,e){return t[0]=Math.min(n[0],e[0]),t[1]=Math.min(n[1],e[1]),t[2]=Math.min(n[2],e[2]),t}function ee(t,n,e){return t[0]=Math.max(n[0],e[0]),t[1]=Math.max(n[1],e[1]),t[2]=Math.max(n[2],e[2]),t}function re(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t}function ie(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t}function oe(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t}function ae(t,n){let e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2];return Math.sqrt(e*e+r*r+i*i)}function ue(t,n){let e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2];return e*e+r*r+i*i}function se(t){let n=t[0],e=t[1],r=t[2];return n*n+e*e+r*r}function ce(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t}function he(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t}function fe(t,n){let e=n[0],r=n[1],i=n[2],o=e*e+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=n[0]*o,t[1]=n[1]*o,t[2]=n[2]*o),t}function le(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function de(t,n,e){let r=n[0],i=n[1],o=n[2],a=e[0],u=e[1],s=e[2];return t[0]=i*s-o*u,t[1]=o*a-r*s,t[2]=r*u-i*a,t}function me(t,n,e,r){let i=n[0],o=n[1],a=n[2];return t[0]=i+r*(e[0]-i),t[1]=o+r*(e[1]-o),t[2]=a+r*(e[2]-a),t}function pe(t,n,e,r,i,o){let a=o*o,u=a*(2*o-3)+1,s=a*(o-2)+o,c=a*(o-1),h=a*(3-2*o);return t[0]=n[0]*u+e[0]*s+r[0]*c+i[0]*h,t[1]=n[1]*u+e[1]*s+r[1]*c+i[1]*h,t[2]=n[2]*u+e[2]*s+r[2]*c+i[2]*h,t}function Me(t,n,e,r,i,o){let a=1-o,u=a*a,s=o*o,c=u*a,h=3*o*u,f=3*s*a,l=s*o;return t[0]=n[0]*c+e[0]*h+r[0]*f+i[0]*l,t[1]=n[1]*c+e[1]*h+r[1]*f+i[1]*l,t[2]=n[2]*c+e[2]*h+r[2]*f+i[2]*l,t}function be(t,n){n=n||1;let e=2*M()*Math.PI,r=2*M()-1,i=Math.sqrt(1-r*r)*n;return t[0]=Math.cos(e)*i,t[1]=Math.sin(e)*i,t[2]=r*n,t}function ge(t,n,e){let r=n[0],i=n[1],o=n[2],a=e[3]*r+e[7]*i+e[11]*o+e[15];return a=a||1,t[0]=(e[0]*r+e[4]*i+e[8]*o+e[12])/a,t[1]=(e[1]*r+e[5]*i+e[9]*o+e[13])/a,t[2]=(e[2]*r+e[6]*i+e[10]*o+e[14])/a,t}function ve(t,n,e){let r=n[0],i=n[1],o=n[2];return t[0]=r*e[0]+i*e[3]+o*e[6],t[1]=r*e[1]+i*e[4]+o*e[7],t[2]=r*e[2]+i*e[5]+o*e[8],t}function _e(t,n,e){let r=n[0],i=n[1],o=n[2],a=e[0],u=e[1],s=e[2],c=e[3],h=c*r+u*o-s*i,f=c*i+s*r-a*o,l=c*o+a*i-u*r,d=-a*r-u*i-s*o;return t[0]=h*c+d*-a+f*-s-l*-u,t[1]=f*c+d*-u+l*-a-h*-s,t[2]=l*c+d*-s+h*-u-f*-a,t}function we(t,n,e,r){let i=[],o=[];return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t}function Ee(t,n,e,r){let i=[],o=[];return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t}function xe(t,n,e,r){let i=[],o=[];return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t}function Ae(t,n){let e=Xn(t[0],t[1],t[2]),r=Xn(n[0],n[1],n[2]);fe(e,e),fe(r,r);let i=le(e,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}function Te(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Re(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}function Fe(t,n){let e=t[0],r=t[1],i=t[2],o=n[0],a=n[1],u=n[2];return Math.abs(e-o)<=m*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(r-a)<=m*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-u)<=m*Math.max(1,Math.abs(i),Math.abs(u))}const Se=$n,ye=Kn,Ce=Zn,De=ae,Oe=ue,Pe=zn,Ne=se,Le=function(){let t=Vn();return function(n,e,r,i,o,a){let u,s;for(e||(e=3),r||(r=0),s=i?Math.min(i*e+r,n.length):n.length,u=r;u<s;u+=e)t[0]=n[u],t[1]=n[u+1],t[2]=n[u+2],o(t,t,a),n[u]=t[0],n[u+1]=t[1],n[u+2]=t[2];return n}}();function Be(){let t=new p(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Ue(t){let n=new p(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function qe(t,n,e,r){let i=new p(4);return i[0]=t,i[1]=n,i[2]=e,i[3]=r,i}function Ie(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function Ge(t,n,e,r,i){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t}function je(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t}function ke(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t}function Ve(t,n,e){return t[0]=n[0]*e[0],t[1]=n[1]*e[1],t[2]=n[2]*e[2],t[3]=n[3]*e[3],t}function He(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t[2]=n[2]/e[2],t[3]=n[3]/e[3],t}function ze(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t[3]=Math.ceil(n[3]),t}function Xe(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t[3]=Math.floor(n[3]),t}function We(t,n,e){return t[0]=Math.min(n[0],e[0]),t[1]=Math.min(n[1],e[1]),t[2]=Math.min(n[2],e[2]),t[3]=Math.min(n[3],e[3]),t}function Ye(t,n,e){return t[0]=Math.max(n[0],e[0]),t[1]=Math.max(n[1],e[1]),t[2]=Math.max(n[2],e[2]),t[3]=Math.max(n[3],e[3]),t}function Qe(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t[3]=Math.round(n[3]),t}function $e(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t}function Ke(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t}function Ze(t,n){let e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2],o=n[3]-t[3];return Math.sqrt(e*e+r*r+i*i+o*o)}function Je(t,n){let e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2],o=n[3]-t[3];return e*e+r*r+i*i+o*o}function tr(t){let n=t[0],e=t[1],r=t[2],i=t[3];return Math.sqrt(n*n+e*e+r*r+i*i)}function nr(t){let n=t[0],e=t[1],r=t[2],i=t[3];return n*n+e*e+r*r+i*i}function er(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t}function rr(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t[3]=1/n[3],t}function ir(t,n){let e=n[0],r=n[1],i=n[2],o=n[3],a=e*e+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=e*a,t[1]=r*a,t[2]=i*a,t[3]=o*a),t}function or(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]}function ar(t,n,e,r){let i=n[0],o=n[1],a=n[2],u=n[3];return t[0]=i+r*(e[0]-i),t[1]=o+r*(e[1]-o),t[2]=a+r*(e[2]-a),t[3]=u+r*(e[3]-u),t}function ur(t,n){return n=n||1,t[0]=M(),t[1]=M(),t[2]=M(),t[3]=M(),ir(t,t),$e(t,t,n),t}function sr(t,n,e){let r=n[0],i=n[1],o=n[2],a=n[3];return t[0]=e[0]*r+e[4]*i+e[8]*o+e[12]*a,t[1]=e[1]*r+e[5]*i+e[9]*o+e[13]*a,t[2]=e[2]*r+e[6]*i+e[10]*o+e[14]*a,t[3]=e[3]*r+e[7]*i+e[11]*o+e[15]*a,t}function cr(t,n,e){let r=n[0],i=n[1],o=n[2],a=e[0],u=e[1],s=e[2],c=e[3],h=c*r+u*o-s*i,f=c*i+s*r-a*o,l=c*o+a*i-u*r,d=-a*r-u*i-s*o;return t[0]=h*c+d*-a+f*-s-l*-u,t[1]=f*c+d*-u+l*-a-h*-s,t[2]=l*c+d*-s+h*-u-f*-a,t[3]=n[3],t}function hr(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function fr(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function lr(t,n){let e=t[0],r=t[1],i=t[2],o=t[3],a=n[0],u=n[1],s=n[2],c=n[3];return Math.abs(e-a)<=m*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(r-u)<=m*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-s)<=m*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-c)<=m*Math.max(1,Math.abs(o),Math.abs(c))}const dr=ke,mr=Ve,pr=He,Mr=Ze,br=Je,gr=tr,vr=nr,_r=function(){let t=Be();return function(n,e,r,i,o,a){let u,s;for(e||(e=4),r||(r=0),s=i?Math.min(i*e+r,n.length):n.length,u=r;u<s;u+=e)t[0]=n[u],t[1]=n[u+1],t[2]=n[u+2],t[3]=n[u+3],o(t,t,a),n[u]=t[0],n[u+1]=t[1],n[u+2]=t[2],n[u+3]=t[3];return n}}();function wr(){let t=new p(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Er(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function xr(t,n,e){e*=.5;let r=Math.sin(e);return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=Math.cos(e),t}function Ar(t,n){let e=2*Math.acos(n[3]),r=Math.sin(e/2);return 0!=r?(t[0]=n[0]/r,t[1]=n[1]/r,t[2]=n[2]/r):(t[0]=1,t[1]=0,t[2]=0),e}function Tr(t,n,e){let r=n[0],i=n[1],o=n[2],a=n[3],u=e[0],s=e[1],c=e[2],h=e[3];return t[0]=r*h+a*u+i*c-o*s,t[1]=i*h+a*s+o*u-r*c,t[2]=o*h+a*c+r*s-i*u,t[3]=a*h-r*u-i*s-o*c,t}function Rr(t,n,e){e*=.5;let r=n[0],i=n[1],o=n[2],a=n[3],u=Math.sin(e),s=Math.cos(e);return t[0]=r*s+a*u,t[1]=i*s+o*u,t[2]=o*s-i*u,t[3]=a*s-r*u,t}function Fr(t,n,e){e*=.5;let r=n[0],i=n[1],o=n[2],a=n[3],u=Math.sin(e),s=Math.cos(e);return t[0]=r*s-o*u,t[1]=i*s+a*u,t[2]=o*s+r*u,t[3]=a*s-i*u,t}function Sr(t,n,e){e*=.5;let r=n[0],i=n[1],o=n[2],a=n[3],u=Math.sin(e),s=Math.cos(e);return t[0]=r*s+i*u,t[1]=i*s-r*u,t[2]=o*s+a*u,t[3]=a*s-o*u,t}function yr(t,n){let e=n[0],r=n[1],i=n[2];return t[0]=e,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-e*e-r*r-i*i)),t}function Cr(t,n,e,r){let i,o,a,u,s,c=n[0],h=n[1],f=n[2],l=n[3],d=e[0],m=e[1],p=e[2],M=e[3];return(o=c*d+h*m+f*p+l*M)<0&&(o=-o,d=-d,m=-m,p=-p,M=-M),1-o>1e-6?(i=Math.acos(o),a=Math.sin(i),u=Math.sin((1-r)*i)/a,s=Math.sin(r*i)/a):(u=1-r,s=r),t[0]=u*c+s*d,t[1]=u*h+s*m,t[2]=u*f+s*p,t[3]=u*l+s*M,t}function Dr(t,n){let e=n[0],r=n[1],i=n[2],o=n[3],a=e*e+r*r+i*i+o*o,u=a?1/a:0;return t[0]=-e*u,t[1]=-r*u,t[2]=-i*u,t[3]=o*u,t}function Or(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t}function Pr(t,n){let e,r=n[0]+n[4]+n[8];if(r>0)e=Math.sqrt(r+1),t[3]=.5*e,e=.5/e,t[0]=(n[5]-n[7])*e,t[1]=(n[6]-n[2])*e,t[2]=(n[1]-n[3])*e;else{let r=0;n[4]>n[0]&&(r=1),n[8]>n[3*r+r]&&(r=2);let i=(r+1)%3,o=(r+2)%3;e=Math.sqrt(n[3*r+r]-n[3*i+i]-n[3*o+o]+1),t[r]=.5*e,e=.5/e,t[3]=(n[3*i+o]-n[3*o+i])*e,t[i]=(n[3*i+r]+n[3*r+i])*e,t[o]=(n[3*o+r]+n[3*r+o])*e}return t}function Nr(t,n,e,r){let i=.5*Math.PI/180;n*=i,e*=i,r*=i;let o=Math.sin(n),a=Math.cos(n),u=Math.sin(e),s=Math.cos(e),c=Math.sin(r),h=Math.cos(r);return t[0]=o*s*h-a*u*c,t[1]=a*u*h+o*s*c,t[2]=a*s*c-o*u*h,t[3]=a*s*h+o*u*c,t}function Lr(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const Br=Ue,Ur=qe,qr=Ie,Ir=Ge,Gr=je,jr=Tr,kr=$e,Vr=or,Hr=ar,zr=tr,Xr=zr,Wr=nr,Yr=Wr,Qr=ir,$r=fr,Kr=lr,Zr=function(){let t=Vn(),n=Xn(1,0,0),e=Xn(0,1,0);return function(r,i,o){let a=le(i,o);return a<-.999999?(de(t,n,i),Pe(t)<1e-6&&de(t,e,i),fe(t,t),xr(r,t,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(de(t,i,o),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+a,Qr(r,r))}}(),Jr=function(){let t=wr(),n=wr();return function(e,r,i,o,a,u){return Cr(t,r,a,u),Cr(n,i,o,u),Cr(e,t,n,2*u*(1-u)),e}}(),ti=function(){let t=gt();return function(n,e,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-e[0],t[5]=-e[1],t[8]=-e[2],Qr(n,Pr(n,t))}}();function ni(){let t=new p(2);return t[0]=0,t[1]=0,t}function ei(t){let n=new p(2);return n[0]=t[0],n[1]=t[1],n}function ri(t,n){let e=new p(2);return e[0]=t,e[1]=n,e}function ii(t,n){return t[0]=n[0],t[1]=n[1],t}function oi(t,n,e){return t[0]=n,t[1]=e,t}function ai(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t}function ui(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t}function si(t,n,e){return t[0]=n[0]*e[0],t[1]=n[1]*e[1],t}function ci(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t}function hi(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t}function fi(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t}function li(t,n,e){return t[0]=Math.min(n[0],e[0]),t[1]=Math.min(n[1],e[1]),t}function di(t,n,e){return t[0]=Math.max(n[0],e[0]),t[1]=Math.max(n[1],e[1]),t}function mi(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t}function pi(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t}function Mi(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t}function bi(t,n){var e=n[0]-t[0],r=n[1]-t[1];return Math.sqrt(e*e+r*r)}function gi(t,n){var e=n[0]-t[0],r=n[1]-t[1];return e*e+r*r}function vi(t){var n=t[0],e=t[1];return Math.sqrt(n*n+e*e)}function _i(t){var n=t[0],e=t[1];return n*n+e*e}function wi(t,n){return t[0]=-n[0],t[1]=-n[1],t}function Ei(t,n){return t[0]=1/n[0],t[1]=1/n[1],t}function xi(t,n){var e=n[0],r=n[1],i=e*e+r*r;return i>0&&(i=1/Math.sqrt(i),t[0]=n[0]*i,t[1]=n[1]*i),t}function Ai(t,n){return t[0]*n[0]+t[1]*n[1]}function Ti(t,n,e){var r=n[0]*e[1]-n[1]*e[0];return t[0]=t[1]=0,t[2]=r,t}function Ri(t,n,e,r){var i=n[0],o=n[1];return t[0]=i+r*(e[0]-i),t[1]=o+r*(e[1]-o),t}function Fi(t,n){n=n||1;var e=2*M()*Math.PI;return t[0]=Math.cos(e)*n,t[1]=Math.sin(e)*n,t}function Si(t,n,e){var r=n[0],i=n[1];return t[0]=e[0]*r+e[2]*i,t[1]=e[1]*r+e[3]*i,t}function yi(t,n,e){var r=n[0],i=n[1];return t[0]=e[0]*r+e[2]*i+e[4],t[1]=e[1]*r+e[3]*i+e[5],t}function Ci(t,n,e){var r=n[0],i=n[1];return t[0]=e[0]*r+e[3]*i+e[6],t[1]=e[1]*r+e[4]*i+e[7],t}function Di(t,n,e){let r=n[0],i=n[1];return t[0]=e[0]*r+e[4]*i+e[12],t[1]=e[1]*r+e[5]*i+e[13],t}function Oi(t){return"vec2("+t[0]+", "+t[1]+")"}function Pi(t,n){return t[0]===n[0]&&t[1]===n[1]}function Ni(t,n){let e=t[0],r=t[1],i=n[0],o=n[1];return Math.abs(e-i)<=m*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(r-o)<=m*Math.max(1,Math.abs(r),Math.abs(o))}const Li=vi,Bi=ui,Ui=si,qi=ci,Ii=bi,Gi=gi,ji=_i,ki=function(){let t=ni();return function(n,e,r,i,o,a){let u,s;for(e||(e=2),r||(r=0),s=i?Math.min(i*e+r,n.length):n.length,u=r;u<s;u+=e)t[0]=n[u],t[1]=n[u+1],o(t,t,a),n[u]=t[0],n[u+1]=t[1];return n}}();let Vi=s.create(),Hi=s.create(),zi=s.create();s.set(Vi,0,0,-1),s.set(Hi,1,0,0),s.set(zi,0,1,0);class Xi{constructor(t){this.parent=t||void 0,this.position=s.create(),this.rotation=h.create(),this.scale=s.create(),s.set(this.scale,1,1,1)}toLocalMatrix(){let t=u.create();return u.fromRotationTranslationScale(t,this.rotation,this.position,this.scale),t}toWorldMatrix(){let t=this.toLocalMatrix();if(this.parent){let n=this.parent.toWorldMatrix();u.mul(t,n,t)}return t}setParent(t){this.parent=t}detach(){if(this.parent){let t=this.toWorldMatrix(),n=s.clone(this.scale);this.fromWorldMatrix(t),n[0]*=this.parent.scale[0],n[1]*=this.parent.scale[1],n[2]*=this.parent.scale[2],s.copy(this.scale,n),this.parent=void 0}}fromWorldMatrix(t){u.getTranslation(this.position,t),u.getRotation(this.rotation,t),u.getScaling(this.scale,t)}get forward(){let t=s.create();return s.transformQuat(t,Vi,this.rotation),t}get right(){let t=s.create();return s.transformQuat(t,Hi,this.rotation),t}get up(){let t=s.create();return s.transformQuat(t,zi,this.rotation),t}applyRotation(t){h.mul(this.rotation,this.rotation,t)}setEuler(t,n,e){h.fromEuler(this.rotation,t,n,e),h.normalize(this.rotation,this.rotation)}eulerAdd(t,n,e){let r=h.create();h.fromEuler(r,t,n,e),h.mul(this.rotation,this.rotation,r)}setAxes(t,n,e){h.setAxes(this.rotation,t,n,e)}setAxisAngle(t,n){h.setAxisAngle(this.rotation,t,n)}getAxisAngle(){let t=s.create();return h.getAxisAngle(t,this.rotation),t}applyAxisAngle(t,n){let e=h.create();h.setAxisAngle(e,t,n),h.mul(this.rotation,this.rotation,e)}translate(t){s.copy(this.position,t)}applyTranslation(t){s.add(this.position,this.position,t)}applyScale(t){s.mul(this.scale,this.scale,t)}setScale(t){s.copy(this.scale,t)}}class Wi{constructor(){this.gameObject=void 0,this.transform=void 0,this.active=!0}enable(){this.active=!0}disable(){this.active=!1}setOwner(t){this.gameObject=t,this.transform=this.gameObject.transform}getComponent(t){if(this.gameObject)return this.gameObject.getComponent(t)}onAttach(){}awake(){}start(){}clone(){let t=new this.constructor;return(t=Object.assign(t,this)).gameObject=void 0,t.transform=void 0,t}}class Yi extends Wi{constructor(){super(),this.kinematic=!1}simulate(t){}}class Qi extends Wi{constructor(){super()}update(t){}lateUpdate(t){}}class $i extends Wi{constructor(){super()}render(){}}class Ki extends $i{constructor(t,n){super(),this.mesh=t,this.material=n}clone(){let t=new this.constructor;return(t=Object.assign(t,this)).gameObject=void 0,t.transform=void 0,t.material=new this.material.constructor,t.material=Object.assign(t.material,this.material),t}render(){this.mesh.render(this.material.drawMode)}}class Zi{constructor(t,n,e,r,i,o){this.location=t,this.size=n,this.type=e,this.normalized=r,this.stride=i,this.offset=o}}class Ji{constructor(t,n,e){this.position=t||[0,0,0],this.normal=n||[0,1,0],this.uv=e||[0,0]}toArray(){let t=this.position;return t=(t=t.concat(this.normal)).concat(this.uv)}}let to=[{name:"a_position",elements:3},{name:"a_normal",elements:3},{name:"a_texCoords",elements:2}],no=Float32Array.BYTES_PER_ELEMENT;function eo(t){return t*no}let ro=function(t){let n=0;for(let e of t)n+=e.elements;return n}(to);let io=function(t){let n=[],e=eo(ro),r=0;for(let i=0;i<t.length;i++){let o=t[i],a=i;n.push({name:o.name,attribute:new Zi(a,o.elements,d.FLOAT,!1,e,r)}),r+=eo(o.elements)}return n}(to);class oo{constructor(t,n,e){this.name=e||"",this.vertexSource=t,this.fragmentSource=n,this.vs=void 0,this.fs=void 0,this.program=void 0,this.attributeNames=[];for(let t of io)this.attributeNames.push(t.name);this.attributes={},this.uniforms={},this.binded=!1,this.compiled=!1}setVertexShader(t){this.vertexSource=t}setFragmentShader(t){this.fragmentSource=t}compile(){this.compiled&&(d.deleteShader(this.vs),d.deleteShader(this.fs),d.deleteProgram(this.program),this.attributes={},this.uniforms={},this.compiled=!1),this.vs=this._createShader(d.VERTEX_SHADER,this.vertexSource),this.fs=this._createShader(d.FRAGMENT_SHADER,this.fragmentSource),this.program=this._createProgram(this.vs,this.fs),null!==this.program&&(this.attributes=Object.assign({},this._getAttributeLocations(this.attributeNames)),this.uniforms=Object.assign({},this._getUniformLocations(["u_model","u_view","u_perspective"])),this.compiled=!0)}setMatrixUniforms(t,n,e){this.binded?(this.setMatrix("u_model",t),this.setMatrix("u_view",n),this.setMatrix("u_perspective",e)):console.warn(this.name+": Could not set unifoms. This shader is not currently binded")}setFloat(t,n){if(!this.binded)return void console.warn(this.name+": Could not set unifoms. This shader is not currently binded");let e=this._getOrAddUniform(t);null!==e&&d.uniform1f(e,n)}setInt(t,n){if(!this.binded)return void console.warn(this.name+": Could not set unifoms. This shader is not currently binded");let e=this._getOrAddUniform(t);null!==e&&d.uniform1i(e,n)}setVecf(t,n){if(!this.binded)return void console.warn(this.name+": Could not set unifoms. This shader is not currently binded");let e=this._getOrAddUniform(t);if(null!==e)switch(n.length){case 1:d.uniform1fv(e,n);break;case 2:d.uniform2fv(e,n);break;case 3:d.uniform3fv(e,n);break;case 4:d.uniform4fv(e,n);break;default:console.warn(`${this.name}: Vector length ${n.length} is not supported `)}}setVeci(t,n){if(!this.binded)return void console.warn(this.name+": Could not set unifoms. This shader is not currently binded");let e=this._getOrAddUniform(t);if(null!==e)switch(n.length){case 1:d.uniform1iv(e,n);break;case 2:d.uniform2iv(e,n);break;case 3:d.uniform3iv(e,n);break;case 4:d.uniform4iv(e,n);break;default:console.warn(`${this.name}: Vector length ${n.length} is not supported `)}}setMatrix(t,n){if(!this.binded)return void console.warn(this.name+": Could not set unifoms. This shader is not currently binded");let e=this._getOrAddUniform(t);if(null!==e)switch(n.length){case 4:d.uniformMatrix2fv(e,!1,n);break;case 9:d.uniformMatrix3fv(e,!1,n);break;case 16:d.uniformMatrix4fv(e,!1,n);break;default:console.warn(`${this.name}: Matrix length ${n.length} is not supported `)}}setStruct(t,n,e){if(!this.binded)return void console.warn(this.name+": Could not set unifoms. This shader is not currently binded");let r=e||d.FLOAT,i=this,o=function(t,n,e){for(let r in n){let o=`${t}.${r}`,a=n[r];Array.isArray(a)?a.length<=4?e==d.FLOAT?i.setVecf(o,a):e==d.INT&&i.setVeci(o,a):i.setMatrix(o,a):e==d.FLOAT?i.setFloat(o,a):e==d.INT&&i.setInt(o,a)}};if(Array.isArray(n))for(let e=0;e<n.length;e++){o(`${t}[${e}]`,n[e],r)}else o(t,n,r)}bind(){this.binded||(d.useProgram(this.program),this.binded=!0)}unbind(){d.useProgram(null),this.binded=!1}_getOrAddUniform(t){if(!this.uniforms[t]&&null!==this.uniforms[t]){let n=this._getUniformLocation(t);this.uniforms=Object.assign(this.uniforms,n),null===n[t]&&console.warn(this.name+": No uniform with name "+t+" was found.")}return this.uniforms[t]}_createShader(t,n){let e=d.createShader(t);return d.shaderSource(e,n),d.compileShader(e),d.getShaderParameter(e,d.COMPILE_STATUS)?e:(console.error(d.getShaderInfoLog(e)),d.deleteShader(e),null)}_createProgram(t,n){let e=d.createProgram();d.attachShader(e,t),d.attachShader(e,n);for(let t=0;t<io.length;t++)d.bindAttribLocation(e,t,io[t].name);return d.linkProgram(e),d.getProgramParameter(e,d.LINK_STATUS)?e:(console.error(d.getProgramInfoLog(e)),d.deleteProgram(e),null)}_getLocation(t,n){let e,r={};return"attribute"==t?e=d.getAttribLocation(this.program,n):"uniform"==t&&(e=d.getUniformLocation(this.program,n)),r[n]=e,r}_getAttributeLocation(t){return this._getLocation("attribute",t)}_getAttributeLocations(t){let n={};for(let e of t){let t=this._getAttributeLocation(e);n=Object.assign(n,t)}return n}_getUniformLocation(t){return this._getLocation("uniform",t)}_getUniformLocations(t){let n={};for(let e of t){let t=this._getUniformLocation(e);t&&(n=Object.assign(n,t))}return n}}class ao{constructor(t,n){this.vertices=t,this.array=this._toSingleArray(),this.count=t.length,this.layout=n}push(t){t instanceof Ji&&this.vertices.push(t)}_toSingleArray(){let t=[];for(let n of this.vertices){let e=n.toArray();t=t.concat(e)}return new Float32Array(t)}}class uo{constructor(t,n,e){this.vertices=t,this.indices=n,this.isIndexed=!!n,this.usage=e||d.STATIC_DRAW,this.binded=!1,this.buffers=void 0}render(t){this.bind(),this.isIndexed?d.drawElements(t,this.indices.length,d.UNSIGNED_SHORT,0):d.drawArrays(t,0,this.vertices.count),this.unbind()}bind(){this.binded||(this.buffers||this._initBuffers(),d.bindVertexArray(this.buffers.VAO),this.binded=!0)}unbind(){this.binded&&(d.bindVertexArray(null),this.binded=!1)}_initBuffers(){this.buffers={},this.buffers.VAO=d.createVertexArray(),this.buffers.VBO=d.createBuffer(),this.buffers.EBO=this.isIndexed?d.createBuffer():void 0,d.bindVertexArray(this.buffers.VAO),d.bindBuffer(d.ARRAY_BUFFER,this.buffers.VBO),d.bufferData(d.ARRAY_BUFFER,this.vertices.array,this.usage),this.isIndexed&&(d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this.buffers.EBO),d.bufferData(d.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),this.usage));for(let t of this.vertices.layout){let n=t.attribute;d.vertexAttribPointer(n.location,n.size,n.type,n.normalized,n.stride,n.offset),d.enableVertexAttribArray(n.location)}d.bindVertexArray(null),d.bindBuffer(d.ARRAY_BUFFER,null),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null)}}let so={Triangle:function(t){const n=.5*t||.5;let e=[new Ji([0,n,0],[0,0,1]),new Ji([-n,-n,0],[0,0,1]),new Ji([n,-n,0],[0,0,1])],r=new ao(e,io);return new uo(r)},Quad:function(t){const n=.5*t||.5;let e=[new Ji([n,n,0],[0,0,1],[1,1]),new Ji([n,-n,0],[0,0,1],[1,0]),new Ji([-n,-n,0],[0,0,1],[0,0]),new Ji([-n,n,0],[0,0,1],[0,1])],r=new ao(e,io);return new uo(r,[0,3,1,1,3,2])},Box:function(t,n,e){const r=.5*t||.5,i=.5*n||.5,o=.5*e||.5;let a=[new Ji([-r,-i,-o],[0,0,-1],[0,0]),new Ji([r,-i,-o],[0,0,-1],[1,0]),new Ji([r,i,-o],[0,0,-1],[1,1]),new Ji([r,i,-o],[0,0,-1],[1,1]),new Ji([-r,i,-o],[0,0,-1],[0,1]),new Ji([-r,-i,-o],[0,0,-1],[0,0]),new Ji([-r,-i,o],[0,0,1],[0,0]),new Ji([r,-i,o],[0,0,1],[1,0]),new Ji([r,i,o],[0,0,1],[1,1]),new Ji([r,i,o],[0,0,1],[1,1]),new Ji([-r,i,o],[0,0,1],[0,1]),new Ji([-r,-i,o],[0,0,1],[0,0]),new Ji([-r,i,o],[-1,0,0],[1,0]),new Ji([-r,i,-o],[-1,0,0],[1,1]),new Ji([-r,-i,-o],[-1,0,0],[0,1]),new Ji([-r,-i,-o],[-1,0,0],[0,1]),new Ji([-r,-i,o],[-1,0,0],[0,0]),new Ji([-r,i,o],[-1,0,0],[1,0]),new Ji([r,i,o],[1,0,0],[1,0]),new Ji([r,i,-o],[1,0,0],[1,1]),new Ji([r,-i,-o],[1,0,0],[0,1]),new Ji([r,-i,-o],[1,0,0],[0,1]),new Ji([r,-i,o],[1,0,0],[0,0]),new Ji([r,i,o],[1,0,0],[1,0]),new Ji([-r,-i,-o],[0,-1,0],[0,1]),new Ji([r,-i,-o],[0,-1,0],[1,1]),new Ji([r,-i,o],[0,-1,0],[1,0]),new Ji([r,-i,o],[0,-1,0],[1,0]),new Ji([-r,-i,o],[0,-1,0],[0,0]),new Ji([-r,-i,-o],[0,-1,0],[0,1]),new Ji([-r,i,-o],[0,1,0],[0,1]),new Ji([r,i,-o],[0,1,0],[1,1]),new Ji([r,i,o],[0,1,0],[1,0]),new Ji([r,i,o],[0,1,0],[1,0]),new Ji([-r,i,o],[0,1,0],[0,0]),new Ji([-r,i,-o],[0,1,0],[0,1])],u=new ao(a,io);return new uo(u)}};let co=new class{constructor(){this.shaders={},this.meshes={},this.currentShader}bindShader(t){this.currentShader!=t&&(this.currentShader&&this.currentShader.unbind(),this.currentShader=t,this.currentShader.bind())}createShader(t,n,e){if(this.shaders[t])console.warn("Resource manager: "+t+" could not be created because there is another shader with the same name.");else{let r=new oo(n,e,t);r.compile(),this.addShader(t,r)}return this.shaders[t]}addShader(t,n){!n instanceof oo?console.warn("Resource manager: object is not instance of Shader"):this.shaders[t]||(this.shaders[t]=n)}getShader(t){return this.shaders[t]}},ho={none:0,unlit:1,lit:2,translucent:3,postprocess:4};Object.freeze(ho);class fo{constructor(t,n){let e=n||{};this.shader=t,this.drawMode=e.drawMode||d.TRIANGLES,this.culling=e.culling||{enable:!1,mode:d.BACK},this.depthTest=e.depthTest||!0,this.tag=e.tag||ho.none,this.uniformType=d.FLOAT,this.mModel=u.create(),this.mView=u.create(),this.mPerspective=u.create()}setup(){this.depthTest?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.culling.enable?(d.enable(d.CULL_FACE),d.cullFace(this.culling.mode)):d.disable(d.CULL_FACE)}setMatrices(t,n,e){this.mModel=t,this.mView=n,this.mPerspective=e,this.tag!=ho.lit&&this.tag!=ho.translucent||(this.mNormal||(this.mNormal=u.create()),lux.mat4.invert(this.mNormal,t),lux.mat4.transpose(this.mNormal,this.mNormal))}update(){this.shader.setMatrixUniforms(this.mModel,this.mView,this.mPerspective),this.tag!=ho.lit&&this.tag!=ho.translucent||(this.mNormal||(this.mNormal=u.create()),this.shader.setMatrix("u_mNormal",this.mNormal))}use(){this.shader.binded||(co.bindShader(this.shader),this.setup()),this.update()}}class lo{constructor(){this.unlit=[],this.lit=[],this.translucent=[]}add(t){if(!(!t instanceof Ki))switch(t.material.tag){case ho.none:case ho.unlit:this.unlit.push(t);break;case ho.lit:this.lit.push(t);break;case ho.translucent:this.translucent.push(t);break;default:this.unlit.push(t)}}}class mo{constructor(){this.transform=new Xi,this.mPerspective=u.create(),this.mView=u.create(),this.exposure=1}}class po{constructor(t,n,e){this.level=t.level||0,this.internalFormat=t.internalFormat||d.RGB,this.border=t.border||0,this.format=t.format||d.RGB,this.type=t.type||d.UNSIGNED_BYTE,this.wrap={S:d.REPEAT,T:d.REPEAT},this.filtering={min:d.NEAREST,mag:d.LINEAR},this.wrap.S=e.S||this.wrap.S,this.wrap.T=e.T||this.wrap.T,this.filtering.min=n.min||this.filtering.min,this.filtering.mag=n.mag||this.filtering.mag}}let Mo={RGB:()=>new po,sRGB:()=>new po,FB_COLOR:()=>new po({internalFormat:d.RGBA,format:d.RGBA,type:d.UNSIGNED_BYTE},{min:d.LINEAR,mag:d.LINEAR},{S:d.CLAMP_TO_EDGE,T:d.CLAMP_TO_EDGE}),FB_HDR_COLOR:()=>new po({internalFormat:d.RGBA16F,format:d.RGBA,type:d.FLOAT},{min:d.NEAREST,mag:d.NEAREST},{S:d.CLAMP_TO_EDGE,T:d.CLAMP_TO_EDGE}),FB_DEPTH:()=>new po({internalFormat:d.DEPTH_COMPONENT24,format:d.DEPTH_COMPONENT,type:d.UNSIGNED_INT},{min:d.NEAREST,mag:d.NEAREST},{S:d.CLAMP_TO_EDGE,T:d.CLAMP_TO_EDGE}),FB_STENCIL:()=>new po({internalFormat:d.RGBA,format:d.RGBA,type:d.UNSIGNED_BYTE},{min:d.LINEAR,mag:d.LINEAR},{S:d.CLAMP_TO_EDGE,T:d.CLAMP_TO_EDGE}),FB_DEPTH_STENCIL:()=>new po({internalFormat:d.RGBA,format:d.RGBA,type:d.UNSIGNED_BYTE},{min:d.LINEAR,mag:d.LINEAR},{S:d.CLAMP_TO_EDGE,T:d.CLAMP_TO_EDGE})};Object.freeze(Mo);const bo=15;class go{constructor(t,n,e,r){this.width=t||256,this.height=n||256,this.data=r,this.textureFormat=e||Mo.RGB(),this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texImage2D(d.TEXTURE_2D,this.textureFormat.level,this.textureFormat.internalFormat,this.width,this.height,this.textureFormat.border,this.textureFormat.format,this.textureFormat.type,this.data),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.textureFormat.filtering.min),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,this.textureFormat.filtering.mag),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,this.textureFormat.wrap.S),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,this.textureFormat.wrap.T)}use(t){let n=t||0;n<0&&(n=0),n>bo&&(n=bo),d.activeTexture(d.TEXTURE0+n),d.bindTexture(d.TEXTURE_2D,this.texture)}dispose(){d.deleteTexture(this.texture)}}class vo{constructor(t,n,e){this.internatFormat=t||d.RGBA8,this.multisample=n||!1,this.samples=e||1}}class _o{constructor(t,n,e){this.format=t||new vo(d.RGBA8,!1),this.width=n,this.height=e,this.buffer=d.createRenderbuffer(),this.bind(),this.format.multisample?d.renderbufferStorageMultisample(d.RENDERBUFFER,this.format.samples,this.format.internatFormat,this.width,this.height):d.renderbufferStorage(d.RENDERBUFFER,this.format.internatFormat,this.width,this.height),this.unbind()}bind(){d.bindRenderbuffer(d.RENDERBUFFER,this.buffer)}unbind(){d.bindRenderbuffer(d.RENDERBUFFER,null)}dispose(){d.deleteRenderbuffer(this.buffer)}}const wo=15;let Eo={TEXTURE:1,RENDERBUFFER:2};class xo{constructor(t,n){this.binded=!1,this.aspect=t/n,this.width=t,this.height=n,this.attachments={color:[],depth:void 0,stencil:void 0,depthStencil:void 0},this.textureColorFormat=Mo.FB_COLOR(),this.renderBufferColorFormat=new vo(d.RGBA8,!1),this.fbo=d.createFramebuffer()}addColor(t,n){let e=this.attachments.color.length,r=!1;e>wo&&(e=wo,r=!0);let i=void 0;if(this.bind(),t==Eo.TEXTURE){if(!(n instanceof po))return void console.error("Framebuffer: Invalid format type for attachment type");let t=n||this.colorFormat;i=new go(this.width,this.height,t,null),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0+e,d.TEXTURE_2D,i.texture,0)}else if(t==Eo.RENDERBUFFER){if(!(n instanceof vo))return void console.error("Framebuffer: Invalid format type for attachment type");let t=n||this.renderBufferColorFormat;i=new _o(t,this.width,this.height),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0+e,d.RENDERBUFFER,i.buffer)}r?(this.attachments.color[e].dispose(),this.attachments.color[e]=i):this.attachments.color.push(i),this.unbind()}addDepth(t,n){let e=void 0;if(this.bind(),t==Eo.TEXTURE){if(void 0!=n&&!(n instanceof po))return void console.error("Framebuffer: Invalid format type for attachment type");this.depthFormat=n||Mo.FB_DEPTH(),e=new go(this.width,this.height,this.depthFormat,null),d.framebufferTexture2D(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.TEXTURE_2D,e.texture,0)}else if(t==Eo.RENDERBUFFER){if(!(n instanceof vo))return void console.error("Framebuffer: Invalid format type for attachment type");this.depthFormat=n||new vo(d.DEPTH_COMPONENT24,!1),e=new _o(this.depthFormat,this.width,this.height),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,e.buffer)}this.attachments.depth=e,this.bind()}addStencil(){}addDepthStencil(){}blit(t,n,e){let r=n||d.COLOR_BUFFER_BIT,i=e||d.NEAREST;if(d.bindFramebuffer(d.READ_FRAMEBUFFER,this.fbo),d.bindFramebuffer(d.DRAW_FRAMEBUFFER,t.fbo),1==this.attachments.color.length)d.blitFramebuffer(0,0,this.width,this.height,0,0,t.width,t.height,r,i);else{let n=0;for(let n=0;n<this.attachments.color.length;n++){if(n>=t.attachments.color.length)return;d.readBuffer(d.COLOR_ATTACHMENT0+n),d.drawBuffers([t.attachments.color[n]]),d.blitFramebuffer(0,0,this.width,this.height,0,0,t.width,t.height,r,i)}if(this.attachments.color.length<t.attachments.color.length){d.readBuffer(d.COLOR_ATTACHMENT0+n);let e=[];for(let r=n;r<t.attachments.color.length;r++)e.push(t.attachments.color[r]);d.drawBuffers(e),d.blitFramebuffer(0,0,this.width,this.height,0,0,t.width,t.height,r,i)}d.drawBuffers([d.BACK])}d.bindFramebuffer(d.READ_FRAMEBUFFER,null),d.bindFramebuffer(d.DRAW_FRAMEBUFFER,null)}bind(){if(!this.binded){this.binded=!0,d.bindFramebuffer(d.FRAMEBUFFER,this.fbo);let t=[];for(let n=0;n<this.attachments.color.length;n++)t.push(d.COLOR_ATTACHMENT0+n);d.drawBuffers(t)}}unbind(){this.binded&&(this.binded=!1,d.bindFramebuffer(d.FRAMEBUFFER,null),d.drawBuffers([d.BACK]))}dispose(){for(let t in this.attachments){let n=this.attachments[t];if(n)if(Array.isArray(n))for(let t of n)t.dispose();else n.dispose()}d.deleteFramebuffer(this.fbo)}}let Ao={vs:"#version 300 es\n        in vec3 a_position;\n        in vec2 a_texCoords;\n    \n        uniform mat4 u_model;\n\n        out vec2 texCoords;\n        void main(void) {\n            gl_Position = u_model * vec4(a_position.xy, 0.0, 1.0);\n            texCoords = a_texCoords;\n        }",ps:"#version 300 es\n        precision mediump float;\n\n        in vec2 texCoords;\n\n        uniform sampler2D u_texture;\n        uniform float u_exposure;\n\n        out vec4 outColor;\n        void main(void) {\n            const float gamma = 2.2;\n\n            vec3 hdrColor = texture(u_texture, texCoords).rgb;\n\n            //Reinhard tone mapping\n            //vec3 mapped = hdrColor / (hdrColor + vec3(1.0));\n            \n            // Exposure tone mapping\n            vec3 mapped = vec3(1.0) - exp(-hdrColor * u_exposure);\n            \n            // Gamma correction \n            mapped = pow(mapped, vec3(1.0 / gamma));\n          \n            outColor = vec4(mapped, 1.0);\n        }"};class To extends fo{constructor(t){let n=t||{};n.tag=n.tag||ho.postprocess,super(co.createShader("hdr-shader",Ao.vs,Ao.ps),n),this.exposure=1}setup(){super.setup()}update(){super.update(),this.shader.setInt("u_texture",0),this.shader.setFloat("u_exposure",this.exposure)}}class Ro{constructor(){this.currentMaterial=void 0,this.currentShader=void 0,this.defaultCamera=new mo,this.renderGroups=new lo,this.hdr={fbo:void 0},this._configureHDR();let t=new To,n=new so.Quad(2);this.screenQuad=new Ki(n,t),this.msaa={enabled:!1,samples:4,fbo:void 0},this._configureMSAA();let e=this;l.onResizeCallback=function(){e._configureHDR(),e._configureMSAA()}}setMSAA(t){t<=1?this.msaa.enabled=!1:(this.msaa.samples=t,this.msaa.samples>8&&(this.msaa.samples=8),this.msaa.enabled=!0),this._configureMSAA()}_configureMSAA(){this.msaa.enabled&&(this.msaa.fbo&&this.msaa.fbo.dispose(),this.msaa.fbo=new xo(l.viewport.width,l.viewport.height),this.msaa.fbo.addColor(Eo.RENDERBUFFER,new vo(d.RGBA16F,!0,this.msaa.samples)),this.msaa.fbo.addDepth(Eo.RENDERBUFFER,new vo(d.DEPTH_COMPONENT24,!0,this.msaa.samples)))}_configureHDR(){let t=Mo.FB_HDR_COLOR();this.hdr.fbo&&this.hdr.fbo.dispose(),this.hdr.fbo=new xo(l.viewport.width,l.viewport.height),this.hdr.fbo.addColor(Eo.TEXTURE,t),this.hdr.fbo.addDepth(Eo.TEXTURE)}render(t){let n=this.defaultCamera;t.cameras.length>0&&(n=t.cameras[0]),this._setupGroups(t),this.msaa.enabled?this.msaa.fbo.bind():this.hdr.fbo.bind(),l.setClearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);let e=!0;d.enable(d.DEPTH_TEST),d.depthFunc(d.LESS),d.disable(d.BLEND);for(let t of this.renderGroups.unlit)t.gameObject.active&&t.active&&this._renderUnlit(t,n);for(let r of t.lights){e||(d.enable(d.BLEND),d.blendFunc(d.ONE,d.ONE),d.depthFunc(d.EQUAL));for(let t of this.renderGroups.lit)t.gameObject.active&&t.active&&this._renderLit(t,n,r);for(let t of this.renderGroups.translucent)t.gameObject.active&&t.active&&this._renderTranslucent(t,n);e&&(e=!1)}this.msaa.enabled?(this.msaa.fbo.unbind(),this.msaa.fbo.blit(this.hdr.fbo,d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT,d.NEAREST)):this.hdr.fbo.unbind(),d.enable(d.DEPTH_TEST),d.depthFunc(d.LESS),d.disable(d.BLEND),l.setClearColor(1,1,1,1),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT),this.screenQuad.material.exposure=n.exposure,this._useMaterial(this.screenQuad.material),this.hdr.fbo.attachments.color[0].use(0),this.screenQuad.render()}_setupGroups(t){this.renderGroups=new lo;for(let n of t.gameObjects){let t=n.getComponents(Ki);for(let n of t)this.renderGroups.add(n)}}_useShader(t){this.currentShader!=t&&(this.currentShader&&this.currentShader.unbind(),this.currentShader=t,this.currentShader.bind())}_useMaterial(t){this.currentMaterial!=t&&(this.currentMaterial=t,this._useShader(this.currentMaterial.shader),this.currentMaterial.setup()),this.currentMaterial.update()}_renderUnlit(t,n){t.material.setMatrices(t.transform.toWorldMatrix(),n.mView,n.mPerspective),this._useMaterial(t.material),t.render()}_renderLit(t,n,e){t.material.setMatrices(t.transform.toWorldMatrix(),n.mView,n.mPerspective),t.material.viewPos=n.transform.position,t.material.light=e,this._useMaterial(t.material),t.render()}_renderTranslucent(t,n){t.material.setMatrices(t.transform.toWorldMatrix(),n.mView,n.mPerspective),this._useMaterial(t.material),t.render()}}class Fo{constructor(t){this.parent=t||void 0,this.scene=void 0,this.transform=new Xi,this.parent&&(this.scene=this.parent.scene,this.transform.setParent(this.parent.transform)),this.children=[],this.components=[],this.input=void 0,this.active=!0,this.tag="gameobject",this.name="gameobject"}awake(){for(let t of this.components)t.awake();for(let t of this.children)t.awake()}start(){for(let t of this.components)t.start();for(let t of this.children)t.start()}add(t){t instanceof Fo?this._addChild(t):t instanceof Wi&&this._addComponent(t)}attach(t){t instanceof Fo?this._addChild(t):t instanceof Wi&&this._addComponent(t)}setActive(t){if(this.active!=t){if(!this.active&&t)for(let t of this.components)t instanceof Qi&&t.awake();this.active=t;for(let n of this.children)n.setActive(t)}}setParent(t){this.parent=t,this.transform.parent=t.transform}findObjectWithName(t){let n=void 0;if(this.name==t)n=this;else for(let e of this.children){if(e.name==t){n=e;break}if(n=e.findObjectWithName(t))break}return n}findObjectsWithTag(t){let n=[];this.tag==t&&n.push(this);for(let e of this.children){e.tag==t&&n.push(e);let r=e.findObjectsWithTag(t);n=n.concat(r)}return n}getComponent(t){for(let n of this.components)if(n instanceof t)return n}getComponents(t){let n=[],e=this.getComponent(t);e&&n.push(e);for(let e of this.children)n=n.concat(e.getComponents(t));return n}getComponentList(t){let n=[];for(let e of this.components)for(let r of t)e instanceof r&&n.push(e);return n}getComponentsList(t){let n=this.getComponentList(t);for(let e of this.children)n=n.concat(e.getComponentsList(t));return n}hasComponent(t){for(let n of this.components)if(n instanceof t)return!0}clone(){let t=new Fo;this.parent&&(t.parent=this.parent,t.scene=this.scene),t.transform.position=s.clone(this.transform.position),t.transform.rotation=h.clone(this.transform.rotation),t.transform.scale=s.clone(this.transform.scale);for(let n of this.components){let e=n.clone();t.attach(e)}for(let n of this.children){let e=n.clone();t.add(e)}return t}_addChild(t){if(!t instanceof Fo)return;let n=!1;for(let e of this.children)if(e==t){n=ture;break}n||(t.setParent(this),this.children.push(t))}_addComponent(t){if(!t instanceof Wi)return;if(t.gameObject)return;let n=t.constructor.name,e=!1;for(let t of this.components)if(t.constructor.name===n){e=ture;break}e||(t.setOwner(this),this.components.push(t),t.onAttach(),t instanceof Qi&&(t.awake(),t.start()))}}class So{constructor(t){this.position=t.position||[0,0,0],this.color=t.color||[1,1,1],this.intensity=t.intensity||1}}class yo{constructor(){this.gameObjects=[],this.lights=[],this.cameras=[],this.isPlaying=!1}add(t){t instanceof Fo?t.scene?console.warn("Scene: Can't add gameobjec to scene, it is already in this scene"):(t.scene=scene,this.gameObjects.push(t),this.isPlaying&&(t.awake(),t.start())):t instanceof So?this.lights.push(t):t instanceof mo&&this.cameras.push(t)}findObjectWithName(t){let n=void 0;for(let e of this.gameObjects)if(n=e.findObjectWithName(t))break;return n}findObjectsWithTag(t){let n=[];for(let e of this.gameObjects){let r=e.findObjectsWithTag(t);n=n.concat(r)}return n}}class Co{constructor(){this.useGravity=!0,this.gravity=s.create(),s.set(this.gravity,0,-9.8,0)}simulate(t,n){for(let e of n)this.useGravity&&e.applyGravity(this.gravity),e.simulate(t)}}let Do=new class{constructor(){this.simulation=new Co,this.renderer=new Ro,this.currentScene=void 0,this.time={deltaTime:0,elapsedTime:0},this.running=!1}useScene(t){!t instanceof yo||(this.currentScene=t,this.currentScene.isPlaying=!0)}swapScene(t){!t instanceof yo||(this.currentScene.isPlaying=!1,this.useScene(t),this.start())}update(t){for(let n of t)n.update(this.time)}lateUpdate(t){for(let n of t)n.lateUpdate(this.time)}coreStart(){for(let t of this.currentScene.gameObjects)t.awake(),t.start()}coreLoop(t){if(this.time.deltaTime=t,this.time.elapsedTime+=t,this.currentScene){let t=[],n=[];for(let e of this.currentScene.gameObjects){let r=e.getComponentsList([Yi,Qi]);for(let e of r)e.active&&(e instanceof Yi?t.push(e):e instanceof Qi&&n.push(e))}this.simulation.simulate(this.time,t),this.update(n),this.lateUpdate(n),this.renderer.render(this.currentScene)}}run(){let t=0,n=this;this.coreStart(),requestAnimationFrame(function e(r){let i=(r*=.001)-t;n.coreLoop(i),t=r,requestAnimationFrame(e)})}},Oo=Do.simulation,Po=Do.renderer;function No(t){Do.useScene(t)}function Lo(t){Do.swapScene(t)}function Bo(){Do.run()}function Uo(t){let n=0;requestAnimationFrame(function e(r){t((r*=.001)-n),n=r,requestAnimationFrame(e)})}class qo extends Yi{constructor(){super(),this.gravityMultiplier=1,this.velocity=s.create(),this.aceleration=s.create()}clone(){let t=new this.constructor;return(t=Object.assign(t,this)).gameObject=void 0,t.transform=void 0,t.velocity=s.create(),t.aceleration=s.create(),t}awake(){this.kinematic||this.gameObject.transform.detach()}applyGravity(t){let n=s.clone(t);s.scale(n,n,this.gravityMultiplier),this.applyForce(n)}applyForce(t){s.add(this.aceleration,this.aceleration,t)}simulate(t){s.scaleAndAdd(this.velocity,this.velocity,this.aceleration,t.deltaTime),s.scaleAndAdd(this.transform.position,this.transform.position,this.velocity,t.deltaTime),s.set(this.aceleration,0,0,0)}}let Io={vs:"#version 300 es\n        in vec3 a_position;\n        in vec3 a_normal;\n    \n        uniform mat4 u_model;\n        uniform mat4 u_view;\n        uniform mat4 u_perspective;\n    \n        void main(void) {\n            gl_Position = u_perspective * u_view * u_model * vec4(a_position, 1.0);\n        }",ps:"#version 300 es\n        precision mediump float;\n        \n        struct Unlit_Material {\n            vec3 emission;\n        };\n\n        uniform Unlit_Material u_material;\n\n        out vec4 outputColor;\n        void main(void) {\n            outputColor = vec4(u_material.emission, 1.0);\n\n            // Gamma correction\n            float gamma = 2.2;\n            outputColor.rgb = pow(outputColor.rgb, vec3(1.0/gamma));\n        }"};class Go extends fo{constructor(t){let n=t||{};n.tag=n.tag||ho.unlit,super(co.createShader("basic-shader",Io.vs,Io.ps),n),this.color=n.color||[1,1,1]}setup(){super.setup()}update(){super.update(),this.shader.setStruct("u_material",{emission:this.color})}}let jo={vs:"#version 300 es\n        in vec3 a_position;\n        in vec3 a_normal;\n      \n        uniform mat4 u_model;\n        uniform mat4 u_view;\n        uniform mat4 u_perspective;\n        uniform mat4 u_mNormal;\n      \n        out vec3 normal;\n        void main(void) {\n            normal = (u_mNormal * vec4(a_normal, 0.0)).xyz;\n            normal = normalize(normal);\n            gl_Position = u_perspective * u_view * u_model * vec4(a_position, 1.0);\n        }",ps:"#version 300 es\n        precision mediump float;\n\n        in vec3 normal;\n\n        out vec4 outputColor;\n        void main(void) {\n            outputColor =  vec4(abs(normal), 1.0);\n\n            // Gamma correction\n            float gamma = 2.2;\n            outputColor.rgb = pow(outputColor.rgb, vec3(1.0/gamma));\n        }"};class ko extends fo{constructor(t){let n=t||{};n.tag=n.tag||ho.unlit,super(co.createShader("normal-shader",jo.vs,jo.ps),n),this.mNormal}setup(){super.setup()}update(){super.update(),this.mNormal||(this.mNormal=u.create()),u.invert(this.mNormal,this.mModel),u.transpose(this.mNormal,this.mNormal),this.shader.setMatrix("u_mNormal",this.mNormal)}}let Vo={vs:"#version 300 es\n        in vec3 a_position;\n        in vec3 a_normal;\n      \n        uniform mat4 u_model;\n        uniform mat4 u_view;\n        uniform mat4 u_perspective;\n        uniform mat4 u_mNormal;\n\n        out vec3 normal;\n        out vec3 fragPos;\n        void main(void) {\n            normal = normalize(vec3(u_mNormal * vec4(a_normal, 0.0)));\n            fragPos = vec3(u_model * vec4(a_position, 1.0));\n            gl_Position = u_perspective * u_view * u_model * vec4(a_position, 1.0);\n        }",ps:"#version 300 es\n        precision mediump float;\n        \n        in vec3 normal;\n        in vec3 fragPos;\n\n        struct Light{\n            vec3 position;\n            vec3 color;\n            float intensity;\n        };\n        \n        struct Material{\n            vec3 ambient;\n            vec3 diffuse;\n        };\n\n        uniform Light u_light;\n        uniform Material u_material;\n\n        out vec4 outputColor;\n        void main(void) {\n\n            // Ambient color\n            vec3 ambient = u_light.intensity * u_light.color * u_material.ambient;\n\n            // Light direction\n            vec3 norm = normalize(normal);\n            \n            vec3 lightDir = (u_light.position - fragPos);\n            float lightDistance = length(lightDir);\n            lightDir = normalize(lightDir); \n\n            // diffuse color\n            float diff = max(dot(norm, lightDir), 0.0);\n            vec3 diffuse = u_light.intensity * u_light.color * (diff * u_material.diffuse);\n\n            // Attenuation\n            //float attenuation = 1.0 / (u_light.constant + u_light.linear * lightDistance + u_light.quadratic * (lightDistance * lightDistance));\n            float attenuation = 1.0 / (lightDistance * lightDistance);\n            ambient *= attenuation;\n            diffuse *= attenuation;\n\n            vec3 result = ambient + diffuse;\n            outputColor = vec4(result, 1.0);\n        }"};class Ho extends fo{constructor(t){let n=t||{};n.tag=n.tag||ho.lit,super(co.createShader("lambert-shader",Vo.vs,Vo.ps),n),this.light=n.light,this.ambient=n.ambient||[1,1,1],this.diffuse=n.diffuse||[1,1,1],this.mNormal=n.mNormal||u.create()}setup(){super.setup()}update(){super.update(),this.shader.setStruct("u_light",this.light),this.shader.setStruct("u_material",{ambient:this.ambient,diffuse:this.diffuse})}}let zo={vs:"#version 300 es\n        precision mediump float;\n\n        in vec3 a_position;\n        in vec3 a_normal;\n      \n        uniform mat4 u_model;\n        uniform mat4 u_view;\n        uniform mat4 u_perspective;\n        uniform mat4 u_mNormal;\n\n        out vec3 normal;\n        out vec3 fragPos;\n\n        void main(void) {\n            normal = normalize(vec3(u_mNormal * vec4(a_normal, 0.0)));\n            fragPos = vec3(u_model * vec4(a_position, 1.0));\n\n            gl_Position = u_perspective * u_view * u_model * vec4(a_position, 1.0);\n        }",ps:"#version 300 es\n        precision mediump float;\n        \n        in vec3 normal;\n        in vec3 fragPos;\n\n        struct Light{\n            vec3 position;\n            vec3 color;\n            float intensity;\n        };\n        \n        struct Material{\n            vec3 ambient;\n            vec3 diffuse;\n            vec3 specular;\n            float shininess;\n        };\n\n        uniform Light u_light;\n        uniform Material u_material;\n\n        uniform vec3 u_viewPos;\n\n        out vec4 outputColor;\n        void main(void) {\n\n            // Ambient color\n            vec3 ambient = u_light.intensity * u_light.color * u_material.ambient;\n\n            // Light direction\n            vec3 norm = normalize(normal);\n            \n            vec3 lightDir = (u_light.position - fragPos);\n            float lightDistance = length(lightDir);\n            lightDir = normalize(lightDir); \n\n            // diffuse color\n            float diff = max(dot(norm, lightDir), 0.0);\n            vec3 diffuse = u_light.intensity * u_light.color * (diff * u_material.diffuse);\n\n            // Specular color\n\n            // Energy conservation for specular shininess\n            const float kPi = 3.14159265;\n            float kShininess = u_material.shininess;\n            float kEnergyConservation = ( 8.0 + kShininess ) / ( 8.0 * kPi );\n\n\n            vec3 viewDir = normalize(u_viewPos - fragPos);\n            vec3 reflectDir = reflect(-lightDir, norm);\n            vec3 halfwayDir = normalize(lightDir + viewDir);\n\n            float spec = kEnergyConservation * pow(max(dot(normal, halfwayDir), 0.0), kShininess);\n\n            //float spec = pow( max( dot(normal, halfwayDir), 0.0 ), 32.0 );\n            vec3 specular = u_light.intensity * u_light.color * (spec * u_material.specular);\n\n\n            // Attenuation\n            //float attenuation = 1.0 / (u_light.constant + u_light.linear * lightDistance + u_light.quadratic * (lightDistance * lightDistance));\n            float attenuation = 1.0 / (lightDistance * lightDistance);\n            ambient *= attenuation;\n            diffuse *= attenuation;\n            specular *= attenuation;\n\n            vec3 result = ambient + diffuse + specular;\n            outputColor = vec4(result, 1.0);\n\n            // Gamma correction\n            //float gamma = 2.2;\n            //outputColor.rgb = pow(outputColor.rgb, vec3(1.0/gamma));    \n        }"};class Xo extends fo{constructor(t){let n=t||{};n.tag=n.tag||ho.lit,super(co.createShader("phong-shader",zo.vs,zo.ps),n),this.light=n.light,this.ambient=n.ambient||[1,1,1],this.diffuse=n.diffuse||[1,1,1],this.specular=n.specular||[1,1,1],this.shininess=n.shininess||8,this.viewPos=n.viewPos||[0,0,0]}setup(){super.setup()}update(){super.update(),this.shader.setMatrix("u_mNormal",this.mNormal),this.shader.setVecf("u_viewPos",this.viewPos),this.shader.setStruct("u_light",this.light),this.shader.setStruct("u_material",{ambient:this.ambient,diffuse:this.diffuse,specular:this.specular,shininess:this.shininess})}}let Wo={vs:"#version 300 es\n        precision mediump float;\n\n        in vec3 a_position;\n        in vec3 a_normal;\n        in vec2 a_texCoords;\n      \n        uniform mat4 u_model;\n        uniform mat4 u_view;\n        uniform mat4 u_perspective;\n        uniform mat4 u_mNormal;\n\n        out vec3 normal;\n        out vec3 fragPos;\n        out vec2 texCoords;\n\n        void main(void) {\n            fragPos = vec3(u_model * vec4(a_position, 1.0));\n            texCoords = a_texCoords;\n\n            gl_Position = u_perspective * u_view * u_model * vec4(a_position, 1.0);\n        }",ps:"#version 300 es\n        precision mediump float;\n        \n        in vec3 fragPos;\n        in vec2 texCoords;\n\n        uniform sampler2D u_texture;\n        uniform float u_exposure;\n\n        out vec4 outputColor;\n        void main(void) {\n\n            const float gamma = 2.2;\n\n            vec3 hdrColor = texture(u_texture, texCoords).rgb;\n            \n            // Exposure tone mapping\n            vec3 mapped = vec3(1.0) - exp(-hdrColor * u_exposure);\n            \n            // Gamma correction \n            mapped = pow(mapped, vec3(1.0 / gamma));\n\n            outputColor = vec4(mapped, 1.0);\n        }"};class Yo extends fo{constructor(t){let n=t||{};n.tag=n.tag||ho.unlit,super(co.createShader("textured-shader",Wo.vs,Wo.ps),n),this.textures=1,this.exposure=1}setup(){super.setup()}update(){super.update(),this.shader.setInt("u_texture",0),this.shader.setFloat("u_exposure",this.exposure)}}e.d(n,"core",function(){return Do}),e.d(n,"simulation",function(){return Oo}),e.d(n,"renderer",function(){return Po}),e.d(n,"useScene",function(){return No}),e.d(n,"swapScene",function(){return Lo}),e.d(n,"run",function(){return Bo}),e.d(n,"loop",function(){return Uo}),e.d(n,"RM",function(){return co}),e.d(n,"Transform",function(){return Xi}),e.d(n,"GameObject",function(){return Fo}),e.d(n,"Component",function(){return Wi}),e.d(n,"PhysicsComponent",function(){return Yi}),e.d(n,"BehaviourComponent",function(){return Qi}),e.d(n,"RenderComponent",function(){return $i}),e.d(n,"Scene",function(){return yo}),e.d(n,"glMatrix",function(){return r}),e.d(n,"vec2",function(){return f}),e.d(n,"vec3",function(){return s}),e.d(n,"vec4",function(){return c}),e.d(n,"quat",function(){return h}),e.d(n,"mat2",function(){return i}),e.d(n,"mat2d",function(){return o}),e.d(n,"mat3",function(){return a}),e.d(n,"mat4",function(){return u}),e.d(n,"PhysicsSimulation",function(){return Co}),e.d(n,"Rigidbody",function(){return qo}),e.d(n,"webgl",function(){return l}),e.d(n,"gl",function(){return d}),e.d(n,"glLoop",function(){}),e.d(n,"AttributePointer",function(){return Zi}),e.d(n,"Vertex",function(){return Ji}),e.d(n,"VERTEX_LAYOUT",function(){return io}),e.d(n,"VertexArray",function(){return ao}),e.d(n,"Mesh",function(){return uo}),e.d(n,"Geometry",function(){return so}),e.d(n,"Texture",function(){return go}),e.d(n,"TextureFormat",function(){return po}),e.d(n,"TexturePresets",function(){return Mo}),e.d(n,"RenderBuffer",function(){return _o}),e.d(n,"RenderBufferFormat",function(){return vo}),e.d(n,"Framebuffer",function(){return xo}),e.d(n,"AttachmentType",function(){return Eo}),e.d(n,"Shader",function(){return oo}),e.d(n,"BaseMaterial",function(){return fo}),e.d(n,"MaterialTag",function(){return ho}),e.d(n,"BasicMaterial",function(){return Go}),e.d(n,"NormalMaterial",function(){return ko}),e.d(n,"LambertMaterial",function(){return Ho}),e.d(n,"PhongMaterial",function(){return Xo}),e.d(n,"TexturedMaterial",function(){return Yo}),e.d(n,"HDRMaterial",function(){return To}),e.d(n,"PointLight",function(){return So}),e.d(n,"Camera",function(){return mo}),e.d(n,"MeshRenderer",function(){return Ki}),e.d(n,"RenderGroups",function(){return lo}),e.d(n,"ForwardRenderer",function(){return Ro})}])});